<HTML>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2" />
<TITLE>Overlay</TITLE>

<link rel="stylesheet" type="text/css" href="style2.css">

</HEAD>

<h3>[yv12][yuy2][rgb32][rgb24]</h3>
<h1>Overlay</h1>
<h2><b>Overlay</b>(clip, clip overlay, int ''x'', int ''y'', clip ''mask'', float ''opacity'', string ''mode'', bool ''greymask'', string ''output'', bool ''ignore_conditional'', bool ''pc_range'')</h2>

<hr>

<p><i><b>overlay</b></i>: klip, który zostanie na³o¿ony na klip zadany parametrem
<i><b>clip</b></i>; rozmiar i przestrzeñ kolorów mo¿e inna ni¿ podstawowego klipu
<br>
<br>
<i><b>x, y</b></i>: te dwie zmienne (wyra¿one w pikselach) okre¶laj± po³o¿enie obrazu nak³adanego na klip.
Mog± przyjmowaæ warto¶ci dodatnie i ujemne (domy¶lnie x=y=0)<br>
<i><b><br>
mask</b></i>: klip ten zostanie u¿yty jako maska przezroczysto¶ci dla nak³adanego obrazu. Rozmiar maski musi byæ taki sam jak klipu zadanego parametrem
<b><i>overlay</i></b>. Domy¶lnie tylko sygna³ lumy jest u¿ywany jako maska. Im maska bêdzie ciemniejsza, tym nak³adany obraz bêdzie bardziej
przezroczysty (parametr ten nie ma warto¶ci domy¶lnej, lecz gdy nie jest podany, to maska bêdzie klipem o luminancji równej
255)<br>
<br>
<i><b>opacity</b></i>: okre¶la poziom przezroczysto¶ci obrazu. Przyjmuje on warto¶ci z przedzia³u [0.0, 1.0]. Przy
<i> opacity=0</i> obraz jest w pe³ni przezroczysty, a przy <i> opacity=1.0</i> jest ca³kowicie nieprzezroczysty (je¿eli nie zosta³a u¿yta maska). Gdy jest on u¿ywany ³±cznie z mask± to jego warto¶æ jest przemna¿ana przez warto¶ci
<b><i> mask</i></b> i w ten sposób uzyskiwana jest koñcowa przezroczysto¶æ</p>

<p><i><b>mode</b></i>: okre¶la sposób, którym klip bêdzie nak³adany na obraz
(dok³adny opis przyjmowanych warto¶ci jest umieszczony w tabelce na koñcu
dokumentu); domy¶lnie <i>mode=&quot;blend&quot;</i>
<br>
<br>
<i><b>greymask</b></i>: okre¶la czy sygna³ chromy z maski zostanie u¿yty dla przezroczysto¶ci
chromy. Do zastosowañ powszechnych zaleca siê wy³±czenie (<i>greymask=false</i>) tej opcji. Zewnêtrzne filtry takie jak
<b> mSharpen</b> i <b> Masktools</b> s± w stanie prawid³owo dostarczyæ mapy
chrominacji; domy¶lnie <i>greymask=true</i></p>

<p><i><b>output</b></i>: parametr ten umo¿liwia zwrócenie klipu w innej przestrzeni kolorów. Dostêpne przestrzenie to "YUY2", "YV12", "RGB24" i "RGB32". Domy¶lnie przestrzeñ wyj¶ciowa jest równa przestrzeni zadanej parametrem
<b><i>clip</i></b><br>
<br>
<i><b>ignore_conditional</b></i>: gdy jego warto¶æ jest równa true to filtr ignoruje zmienne warunkowe. W celu zapoznania siê ze zmiennymi warunkowymi zajrzyj do czê¶ci "Zmienne
warunkowe&quot; (poni¿ej); domy¶lnie <i>ignore_conditional=false</i></p>

<p><i><b>pc_range</b></i>: gdy równy jest true, to umo¿liwi wewnêtrzn± konwersjê RGB -> YUV -> RGB przy za³o¿eniu, ¿e warto¶ci
lumy s± z zakresu [0, 255], a nie jak domy¶lnie [16, 235]. Zmiana tego ustawienia na true jest zalecana tylko pod warunkiem ¶wiadomego dzia³ania (zobacz "Uwagi dotycz±ce przestrzeni
RGB&quot;); domy¶lnie <i>pc_range=false</i></p>

<hr>

<p><b>Overlay</b> nak³ada na siebie dwa klipy u¿ywaj±c do tego ró¿nych metod nak³adania. Nak³adany obraz mo¿e byæ tak¿e przemieszczony. Mo¿liwe jest tak¿e ustalenie parametru przezroczysto¶ci dla nak³adanego klipu.&nbsp;<br>
<br>
Nak³adany klip mo¿e byæ w dowolnej przestrzeni kolorów, co wiêcej przestrzenie dwóch klipów mog± siê ró¿niæ. Klipy wej¶ciowe s± wewnêtrznie konwertowane do formatu YUV, co umo¿liwia filtrowi wygenerowanie klipu w innej przestrzeni ni¿ wej¶ciowa. Mo¿liwe jest u¿ycie ró¿nych przestrzeni dla ka¿dego z klipów, poniewa¿ i tak zostan± one przekonwertowane do YUV. Jednak¿e nie powinno siê u¿ywaæ
<b>Overlay</b> tylko jako filtru s³u¿±cego do zmiany przestrzeni kolorów, poniewa¿ taka zmiana jest wolna i daje w wyniku niewielkie straty na jako¶ci.<br>
<br>
Na ogó³ we wszystkich klipach sygna³y lumy i chromy s± traktowane jako warto¶ci z przedzia³u [0, 255].
Oznacza to, ¿e nie zostan± one ograniczone do warto¶ci obowi±zuj±cych dla standardu CCIR 601. Je¿eli chcesz ograniczyæ sygna³y
lumy i chromy to po <b> Overlay</b> u¿yj filtru <b>Limiter</b>. W celu obejrzenia rozk³adu kolorów mo¿esz u¿yæ filtru
<b> Histogram</b> w trybie <i> Histogram("levels&quot;)</i>. Je¿eli w klipie zadanym parametrem
<b><i>mask</i></b> warto¶ci kolorów mieszcz± siê w zakresie [16, 235] (standard CCIR 601), to wtedy mo¿esz
skorzystaæ z <i>ColorYUV(levels="TV->PC"),</i> by poszerzyæ przedzia³ warto¶ci kolorów do zakresu [0, 255].<br>
<br>
Nie zaleca siê stosowania nak³adek na materiale z przeplotem, chyba, ¿e jest to wykonywane ¶wiadomie.<br>
<br>
<b><font color="#FF0000">UWAGI DOTYCZ¡CE PRZESTRZENI RGB:</font></b><br>
W tej czê¶ci opisu zostanie wyja¶nione zachowanie siê filtru, gdy jeden lub wiêcej klipów jest w przestrzeni RGB.<br>
<br>
Jeden lub wiêcej klipów wej¶ciowych mo¿e byæ w przestrzeni RGB. Aczkolwiek w trakcie obróbki materia³u w przestrzeni YUV konieczna bêdzie konwersja RGB -> YUV.
Konwersja ta mo¿e byæ wykonana na dwa sposoby w zale¿no¶ci od parametru <b><i>pc_range</i></b>. Gdy
<i> pc_range=true</i> to zostanie wykonana konwersja z zachowaniem pe³nego zakresu tj. [0, 255] dla sygna³ów
lumy i chromy. W niektórych przypadkach mo¿e to byæ dobrym rozwi±zaniem:
<ul>
  <li><p>Gdy nak³adany jest klip w przestrzeni RGB przy u¿yciu trybów: "add", "subtract" lub "multiply", wtedy zakres nak³adanego klipu jest lepszy (warto¶ci 0-255), poniewa¿ umo¿liwi on uzyskanie ca³kowicie ciemnych obszarów, które nie bêd± mia³y wp³ywu na wynik koñcowy. W ten sposób do ka¿dej warto¶ci nie bêdzie dodawana warto¶æ 16.</li>
  <li><p>Gdy nie jest wykonywana konwersja przestrzeni kolorów na klipie wyj¶ciowym. Je¿eli przestrzeñ klipu wyj¶ciowego (RGB) jest inna ni¿ klipu wej¶ciowego (YUV) wtedy skala sygna³ów
    lumy i chromy bêdzie nieprawid³owa. Gdy <i> pc_range=true</i>,<i> </i>a klip wej¶ciowy bêdzie w przestrzeni RGB, a wyj¶ciowy w YUY2, to wtedy warto¶ci sygna³ów bêd± spoza przedzia³u [16, 235], tym samym nie bêd± spe³niaæ za³o¿eñ standardu CCIR 601.</li>
</ul>

<p><b>Sposób postêpowania przy materiale wej¶ciowym w przestrzeni RGB</b>
<br>
Dobrym pomys³em mo¿e byæ pozwolenie, aby <b> Overlay</b> na wyj¶ciu da³ przestrzeñ YUY2 pomimo, ¿e na wej¶ciu klip by³ w przestrzeni RGB.
Pozwala to unikn±æ konwersji YUV -> RGB. Nale¿y byæ jednak ¶wiadomym tego, ¿e materia³
wyj¶ciowy mo¿e zostaæ "przeskalowany", jak wspomniano wcze¶niej (gdy zostanie u¿yty parametr
<i> pc_range=true</i>). &quot;Przeskalowanie&quot; mo¿na skorygowaæ do przedzia³u [16, 235] poprzez u¿ycie
<i> ColorYUV(levels="PC->TV&quot;</i>).<br>
<br>
<b>U¿ywanie klipu RGB jako maski</b>
<br>
Klip w przestrzeni RGB dla parametru <b><i>mask</i></b> mo¿e zachowywaæ siê w inny sposób ni¿ powinien. Je¿eli zawsze u¿ywa³e¶ maski w odcieniach szaro¶ci, to pozostawiaj±c parametr
<i> greymask=true</i> (warto¶æ domy¶lna) otrzymasz oczekiwany rezultat. Musisz wiedzieæ, ¿e dla klipu danego parametrem
<b><i> mask</i></b> warto¶ci nie s± nigdy skalowane, tak wiêc automatycznie bêd± z zakresu [0, 255].<br>
<br>
<b>U¿ywanie kana³u alfa (przestrzeñ RGB32)<br>
Overlay</b> nigdy nie u¿yje kana³u alfa zawartego w klipie RGB32. Je¿eli chcesz wydzieliæ kana³ alfa z klipu RGB32 to mo¿esz u¿yæ filtru
<b>ShowAlpha</b>. W celu zachowania maksymalnej jako¶ci zaleca siê wydzielenie kana³u alfa jako RGB.<br>
<br>
<b>Zmienne warunkowe</b><br>
Zmienne globalne <i>ol_opacity_offset</i>, <i>ol_x_offset</i> i <i>ol_y_offset</i> s± odczytywane co jedn± klatkê, a nastêpnie
wykorzystywane. Zmienne te mo¿na modyfikowaæ za pomoc± <b>FrameEvaluate</b>. Warto¶ci w ten sposób uzyskane zostan± dodane do zmiennych oryginalnych dla ka¿dej klatki. Je¿eli ustawisz warto¶æ parametru
<i> x=100</i> i zmienna globalna <i>ol_x_offset</i> bêdzie równa 50 to klip zostanie na³o¿ony w pozycji
<i>x=150</i>.<br>
<br>
Je¿eli u¿ywasz wielu filtrów to modyfikacjê parametrów <i>x</i>,<i> y </i> i<i> opacity</i> mo¿na wy³±czyæ poprzez ustawienie parametru
<b><i> ignore_conditional</i></b> na true. Przyk³ad warunkowej modyfikacji zosta³ umieszczony przy opisie filtru
<b>ConditionalReader</b>.<br>

<p>Warto¶ci, które przyjmuje argument <b><i>mode</i></b>:
<div align="center">
  <center>
  <table border="1" cellpadding="4" cellspacing="0" width="100%">
    <tr>
      <td width="177"><p><i>Blend (mieszanie)</i></td>
      <td width="*%%"><p>Gdy <i> opacity=1.0</i> i nie ma maski, klip zostanie skopiowany na klip bêd±cy
        podstaw±. W innym przypadku klipy zostan± ze sob± zmieszane w stopniu danym przez
        <b><i> opacity</i></b>&nbsp;</td>
    </tr>
    <tr>
      <td width="177"><p><i>Add (dodawanie)</i></td>
      <td width="*%%"><p>W tym trybie nak³adany klip zostanie dodany do klipu podstawowego zwiêkszaj±c tym samym jego
        jasno¶æ. U¿ywaj±c analogii do przestrzeni RGB, obszary o zwiêkszonej luminancji wp³ywaj± na
        chrominacjê czyni±c te obszary jeszcze bardziej bia³ymi</td>
    </tr>
    <tr>
      <td width="177"><p><i>Subtract (odejmowanie)</i></td>
      <td width="*%%"><p> Ten tryb daje odwrotny efekt ni¿ <i> Add</i>, tzn. obszary klipu video zostan±
        przyciemnione</td>
    </tr>
    <tr>
      <td width="177"><p><i>Multiply (mno¿enie)&nbsp;</i></td>
      <td width="*%%"><p>W tym trybie obraz tak¿e zostanie przyciemniony lecz w inny sposób ni¿ dla trybu
        <i> Subtract</i></td>
    </tr>
    <tr>
      <td width="177"><p><i>Chroma</i></td>
      <td width="*%%"><p>Ten tryb umo¿liwi na³o¿enie tylko informacji o kolorze klipu nak³adanego na klip
        podstawowy</td>
    </tr>
    <tr>
      <td width="177"><p><i>Luma</i></td>
      <td width="*%%"><p>Ten tryb umo¿liwi na³o¿enie tylko informacji o jasno¶ci klipu nak³adanego na klip
        podstawowy</td>
    </tr>
    <tr>
      <td width="177"><p><i>Lighten (rozja¶nianie)&nbsp;</i></td>
      <td width="*%%"><p> W tym trybie informacja o jasno¶ci z klipu nak³adanego zostanie skopiowana do klipu
        podstawowego tylko wtedy, gdy klip nak³adany jest ja¶niejszy ni¿ klip
        podstawowy</td>
    </tr>
    <tr>
      <td width="177"><p><i>Darken (zaciemnianie)&nbsp;</i></td>
      <td width="*%%"><p>W tym trybie informacja o jasno¶ci z klipu nak³adanego zostanie skopiowana do klipu
        podstawowego tylko wtedy, gdy klip nak³adany jest ciemniejszy ni¿ klip
        podstawowy</td>
    </tr>
    <tr>
      <td width="177"><p><i>SoftLight&nbsp;</i></td>
      <td width="*%%"><p>Ten tryb rozja¶ni lub przyciemni podstawowy klip w zale¿no¶ci od jasno¶ci nak³adanego klipu. Gdy
        nak³adany klip jest ciemniejszy ni¿ <i> luma=128</i> to klip podstawowy bêdzie ciemniejszy. Natomiast,
        gdy klip nak³adany bêdzie ja¶niejszy od <i> luma=128</i> to klip podstawowy bêdzie ja¶niejszy.
        Tryb ten mo¿e zostaæ u¿yty do dodania cieni do obrazu. Nak³adnie z
        zupe³n± biel± lub czerni± spowoduje wytworzenie siê wyra¼nego ¶ciemniania
        lub rozja¶nienia obrazy, jednak¿e w rezultacie nie bêdzie on dok³adnie
        czarny lub bia³y</td>
    </tr>
    <tr>
      <td width="177"><p><i>HardLight&nbsp;</i></td>
      <td width="*%%"><p>Ten tryb rozja¶ni lub przyciemni podstawowy klip w zale¿no¶ci od jasno¶ci nak³adanego klipu. Gdy
        klip nak³adany jest ciemniejszy ni¿ <i> luma=128</i> to klip podstawowy bêdzie ciemniejszy. Natomiast
        gdy klip nak³adany bêdzie ja¶niejszy od <i> luma=128</i> to klip podstawowy bêdzie ja¶niejszy.
        Tryb ten mo¿e zostaæ u¿yty do dodania cieni do obrazu. Nak³adnie z
        zupe³n± biel± lub czerni± spowoduje wytworzenie siê ca³kowicie
        czarnego lub bia³ego obrazu</td>
    </tr>
    <tr>
      <td width="177"><p><i>Difference (ró¿nica)&nbsp;</i></td>
      <td width="*%%"><p>Ten tryb umo¿liwia wy¶wietlenie ró¿nicy pomiêdzy klipem podstawowym a nak³adanym.
        Podobnie jak w przypadku filtru <b>Subtract</b>, ró¿nica jest wy¶wietlana na szarym tle
        (<i>grey=127</i>). Je¿eli chcesz wy¶wietliæ tylko sam± ró¿nicê to musisz u¿yæ
        <i> ColorYUV(off_y=-127)</i></td>
    </tr>
    <tr>
      <td width="177"><p><i>Exclusion (wykluczenie)&nbsp;</i></td>
      <td width="*%%"><p>W tym trybie obraz podstawowy zostanie odwrócony w zale¿no¶ci od jasno¶ci nak³adanego klipu.
        Mieszanie obrazu podstawowego z bia³ym kolorem spowoduje odwrócenie kolorów klipu
        podstawowego; mieszanie z kolorem czarnym nie spowoduje zmiany kolorów</td>
    </tr>
  </table>
  </center>
</div>

<hr>

<p><b>Przyk³ady:</b>
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
      <td width="561" valign="top" align="left"><p>bg = colorbars(512,384).converttoyuy2()<br>
        text = blankclip(bg).subtitle("Colorbars", size=92, text_color=$ffffff).coloryuv(levels="tv->pc")</p></td>
            <td width="11" valign="top" align="left">
        <p>#</p>
      <td width="*%%" valign="top" align="left"><p>przygotowanie klipów</p></td>
    </tr>
    <tr>
      <td width="561" valign="top" align="left"><p>&nbsp</p></td>
      <td width="11" valign="top" align="left">
        </td>
      <td width="*%%" valign="top" align="left">
        </td>
    </tr>
<tr>
      <td width="561" valign="top" align="left"><p>overlay(bg, text, x=50, y=20, mode="subtract", opacity=0.25)<br>
        overlay(text, x=50, y=120, mode="add", opacity=0.5)<br>
        overlay(text, x=50, y=240, mode="blend", opacity=0.7)</p></td>
            <td width="11" valign="top" align="left">
        <p>#</p>
      <td width="*%%" valign="top" align="left"><p>nak³adanie siê tekstu na trzy ró¿ne sposoby</p></td>
    </tr>
    <tr>
      <td width="561" valign="top" align="left"><p>&nbsp</p></td>
      <td width="11" valign="top" align="left">
        </td>
      <td width="*%%" valign="top" align="left">
        </td>
    </tr>
<tr>
      <td width="561" valign="top" align="left"><p>Overlay(yuy2clip, rgbclip, mask = rgbclip.ShowAlpha("yuy2"))</p></td>
            <td width="11" valign="top" align="left">
        <p>#</p>
      <td width="*%%" valign="top" align="left"><p>na³o¿enie klipu <i> rgbclip</i> na klip
        <i> yuy2clip</i> z mask± yuy2 (zwróæ uwagê, ¿e przedzia³ luminancji maski to [0, 255])</p></td>
    </tr>
    <tr>
      <td width="561" valign="top" align="left"><p>&nbsp</p></td>
      <td width="11" valign="top" align="left">
        </td>
      <td width="*%%" valign="top" align="left">
        </td>
    </tr>
<tr>
      <td width="561" valign="top" align="left"><p>mask = rgbclip.ShowAlpha("rgb").ConvertToYUY2.ColorYUV(levels="TV->PC")<br>
        Overlay(yuy2clip, rgbclip, mask)</p></td>
            <td width="11" valign="top" align="left">
        <p>#</p>
      <td width="*%%" valign="top" align="left"><p>ten sam efekt co wy¿ej</p></td>
    </tr>
    <tr>
      <td width="561" valign="top" align="left"><p>&nbsp</p></td>
      <td width="11" valign="top" align="left">
        </td>
      <td width="*%%" valign="top" align="left">
        </td>
    </tr>
<tr>
      <td width="561" valign="top" align="left"><p>mask = rgbclip.ShowAlpha("rgb")<br>
        Overlay(yuy2clip, rgbclip, mask)</p></td>
            <td width="11" valign="top" align="left">
        <p>#</p>
      <td width="*%%" valign="top" align="left"><p>ten sam efekt co wy¿ej</p></td>
    </tr>

  </table>
<hr>
<h3>translated by Dj_AnT</h3>
</HTML>