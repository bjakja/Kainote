<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Wilbert Dijkhof">
   <title>ConditionalFilter Avisynth Filter</title>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
</head>
<body>
<h2>
<a NAME="ConditionalFilter"></a>ConditionalFilter
</h2>
<p><code>ConditionalFilter </code>(<var>clip testclip, clip source1, clip source2,
string filter, string operator, string value, bool &quot;show&quot;</var>)
<p><code>ConditionalFilter</code> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">retorna</span> <var>source1</var> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">quando a condição formada por
''filter+operator+value '' é conhecida, caso contrário retorna</span> <var>source2</var>.
<span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:EN-US;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se</span> <var>filter</var> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">não é aplicado explicitamente a um clipe, será
aplicado em</span> <var>testclip</var>. <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O áudio é pego de</span> <var>source1</var>.
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Um exemplo. Isto escolherá quadros de vid_blur
quando o valor luma médio de um quadro é menos que 20. Caso contrário serão
retornados os quadros vid.</span>

<pre>vid = AviSource(&quot;file&quot;)
vid_blur = vid.Blur(1.5)
ConditionalFilter(vid, vid_blur, vid, &quot;AverageLuma()&quot;, &quot;lessthan&quot;, &quot;20&quot;)</pre>
<p><var><font color="#000000"><span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; font-family: Microsoft Sans Serif; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA; font-style: normal">Incluindo</span></font></var> <var>show</var>=&quot;true&quot;
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">exibirá os valores atuais na tela.</span>
</p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">A string</span> <var>filter</var>  <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">pode ser qualquer filtro interno, mas também
alguns filtros pré-definidos </span>(<a href="#RuntimeFunctions">funções Runtime</a>).
<br>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">A string</span> <var>operator</var> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">pode ser </span>"equals", &quot;greaterthan&quot;
ou "lessthan". Ou "=", ">" ou "&lt;" respectivamente.
</p>
<h2><a NAME="ScriptClip"></a>ScriptClip
</h2>
<p><code>ScriptClip </code>(<var>clip, string function, bool &quot;show&quot;, bool
&quot;after_frame&quot;</var>)
<p><code>ScriptClip</code> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">retorna o clipe devolvido pela função avaliada
em cada quadro. A string</span> <var>filter</var> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">pode ser qualquer filtro interno, mas também
alguns filtros pré-definidos</span> (<a href="#RuntimeFunctions">funções Runtime</a>).
Incluindo <var>show</var>=&quot;true&quot; <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">exibirá os valores atuais na tela.</span>
</p>
<span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:EN-US;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Alguns exemplos:</span> <br>
<pre># <font size="2">Isto imprimirá a diferença do quadro prévio sobre o atual:</font>
clip = AviSource(&quot;c:\file.avi&quot;)
ScriptClip(clip, &quot;Subtitle(String(YDifferenceFromPrevious))&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Isto aplicará borrado em cada quadro baseado na diferença do prévio.</span>
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Isto também mostrará como os erros são informados em alguns quadros</span> :)
clip = AviSource(&quot;c:\file.avi&quot;)
ScriptClip(clip, &quot;Blur(YDifferenceFromPrevious/20.0)&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Isto aplicará temporalsoften a cenas muito estáticas e aplica um _variable_ blur em cenas de movimento.</span>
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">O borrado agora fica corretamente coberto. Também designamos uma variável - e por que uma quebra de linha é inserida:</span>
function fmin(float f1, float f2) {
&nbsp; return (f1&lt;f2) ? f1 : f2
}
clip = AviSource(&quot;c:\file.avi&quot;)
ScriptClip(clip, &quot;diff = YDifferenceToNext()&quot;+chr(13)+&quot;diff &gt; 2.5 ? Blur(fmin(diff/20,1.5)) : TemporalSoften(2,7,7,3,2)&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Exibe o número do quadro em um clipe:</span>
ScriptClip(&quot;subtitle(string(current_frame))&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Exibe</span> 'frame = the frame-number' <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">em um clipe:</span>
ScriptClip(&quot;&quot;&quot;subtitle(&quot;frame = &quot; + string(current_frame))&quot;&quot;&quot;)</pre>

<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Na v2.55 está incluída uma opção</span> <i><var>after_frame=true/false</var></i>.
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Isto determina se o escrito deve ser avaliado
antes (operação padrão) ou depois que o quadro viesse dos filtros acima.</span></p>

<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">&quot;Restrições&quot;: a produção do escrito
DEVE ser exatamente como o clipe entregue ao ScriptClip (mesma largura e altura
de colorspace). Seu clipe retornado pode ter comprimento diferente - mas o
comprimento do &quot;clipe&quot; sempre é usado. O áudio do &quot;clipe&quot;
é passado intacto. Para duas fontes muito diferentes (MPEG2DEC3 e AviSource) -
você pode colidir com colorspace. Este truque é conhecido.</span>

<h2><a NAME="FrameEvaluate"></a>FrameEvaluate
</h2>
<p><code>FrameEvaluate </code>(<var>clip clip, script function, bool "after_frame"</var>)
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Semelhante a</span> <code>ScriptClip</code>, <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; font-family: Microsoft Sans Serif; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">e</span><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">xceto que a produção do filtro é ignorada.
Isto pode ser usado para designar variáveis, etc. <span style="mso-spacerun:
yes">&nbsp;</span>Os quadros são passados diretamente do clipe dado.</span>
<br>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Na v2.53 uma opção</span> <var>after_frame</var>=<code>true/false</code>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">está incluída. Isto determina se o escrito deve
ser avaliado antes (operação padrão) ou depois que o quadro viesse dos
filtros acima.</span>
<h2><a name="ConditionalReader"></a>ConditionalReader</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Este filtro permite importar informação arbitrária
em uma variável selecionável.</span>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Veja a página dedicada <a href="conditionalreader.htm"><span lang="EN-US" style="mso-ansi-language:EN-US">ConditionalReader</span></a>.</span></p>
<h2><a NAME="RuntimeFunctions"></a>Funções Runtime <b><font face="Microsoft Sans Serif" size="2">(em
tempo de execução)</font></b>
</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Estas são as funções internas nas quais todo
quadro é avaliado.</span>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Estes retornarão média do valor do píxel de um
plano (requer YV12, ISSE):</span>
<br>
  <code>AverageLuma </code>(<var>clip</var>)<br>
  <code>AverageChromaU </code>(<var>clip</var>)<br>
  <code>AverageChromaV </code>(<var>clip</var>)
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Estes retornarão um valor flutuante entre 0 e
255 da diferença absoluta entre dois planos (requer YV12, ISSE):</span>
<br>
  <code>RGBDifference </code>(<var>clip1, clip2</var>)<br>
  <code>LumaDifference </code>(<var>clip1, clip2</var>)<br>
  <code>ChromaUDifference </code>(<var>clip1, clip2</var>)<br>
  <code>ChromaVDifference </code>(<var>clip1, clip2</var>)
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Ao usar estas funções há um último clipe
&quot;implícito&quot; (o primeiro parâmetro não precisa ser especificado),
assim o primeiro parâmetro é substituído pelo testclip.</span>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Estes devem ser muito úteis para detecção de
transições de mudanças de cena:</span>
<br>
  <code>RGBDifferenceFromPrevious </code>(<var>clip</var>)<br>
  <code>YDifferenceFromPrevious </code>(<var>clip</var>)<br>
  <code>UDifferenceFromPrevious </code>(<var>clip</var>)<br>
  <code>VDifferenceFromPrevious </code>(<var>clip</var>)<br>
  <code>RGBDifferenceToNext </code>(<var>clip</var>)<br>
  <code>YDifferenceToNext </code>(<var>clip</var>)<br>
  <code>UDifferenceToNext </code>(<var>clip</var>)<br>
  <code>VDifferenceToNext </code>(<var>clip</var>)<br>
  &nbsp;
<pre># <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Isto substituirá o último quadro antes de uma mudança de cena</span>
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">com o primeiro quadro depois dessa mudança:</span>
ConditionalFilter(last, last, last.trim(1,0), &quot;YDifferenceToNext()&quot;, &quot;&gt;&quot;, &quot;10&quot;, true)</pre>
<h4>Outras funções internas:</h4>
<p><code>YPlaneMax </code>(<var>clip, float threshold</var>)<br>
  <code>UPlaneMax </code>(<var>clip, float threshold</var>)<br>
  <code>VPlaneMax </code>(<var>clip, float threshold</var>)<br>
  <code>YPlaneMin </code>(<var>clip, float threshold</var>)<br>
  <code>UPlaneMin </code>(<var>clip, float threshold</var>)<br>
  <code>VPlaneMin </code>(<var>clip, float threshold</var>)<br>
  <code>YPlaneMedian </code>(<var>clip</var>)<br>
  <code>UPlaneMedian </code>(<var>clip</var>)<br>
  <code>VPlaneMedian </code>(<var>clip</var>)<br>
  <code>YPlaneMinMaxDifference </code>(<var>clip, float threshold</var>)<br>
  <code>UPlaneMinMaxDifference </code>(<var>clip, float threshold</var>)<br>
  <tt><code>VPlaneMinMaxDifference </code></tt>(<i><var>clip, float threshold</var></i>)
<p><var>Threshold</var>  <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">é uma porcentagem, em quanto por cento de píxeis
é permitido acima ou abaixo do mínimo. O percentual é opcional e o padrão é
0.</span>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se você entendeu os materiais acima, pode
prosseguir com &quot;Filtragem Condicional<span style="mso-spacerun: yes">&nbsp;
</span>Avançada&quot;, que vai lhe contar um pouco mais.</span><h2>Filtragem Condicional
Avançada: parte I</h2>
<p style="margin:0cm;margin-bottom:.0001pt">Você terá que saber alguns coisas
sobre a funcionalidade do AviSynth para entender esta seção:</p>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;
mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
mso-ansi-language:PT-BR;mso-fareast-language:PT-BR;mso-bidi-language:AR-SA">Os
escritos são analisados de cima para baixo, mas quando um quadro é pedido o último
filtro é invocado antes, para pedir os quadros de cima, na cadeia de filtro.
Por exemplo:</span>
<pre>AviSource(&quot;myfile.avi&quot;)
ColorYUV(analyze=true)
Histogram()</pre>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Ao abrir o escrito no Vdub acontece o seguinte</span>
<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Quando Vdub pedir um quadro, AviSynth pede o
quadro do Histograma.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O histograma pede um quadro do ColorYUV,</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">ColorYUV do AviSource, que produz quadro,
entrega-o ao ColorYUV.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">ColorYUV processa a imagem e a envia para o
Histograma, que a devolve ao Vdub.</span></li>
</ul>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Assim a cadeia do filtro trabalha basicamente
para trás, dando ao filtro a possibilidade de pedir vários quadros da fonte
acima.</span>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Os filtros condicionais porém, devem avaliar os
escritos <b>antes</b> deles pedirem quadros do filtro acima, porque precisam
saber qual filtro chamar. Um outro assunto importante é que só variáveis <b>globais</b>
definidas no filtro condicional 'environment' podem ser usados fora (e
vice-versa). Dê uma olhada neste escrito:</span>
<pre>v = AviSource(&quot;E:\Temp\Test3\atomic_kitten.avi&quot;).ConvertToYV12

function g(clip c)
{
&nbsp; <b>global</b> <b>w</b> = c
&nbsp; c2 = ScriptClip(c, &quot;subtitle(t)&quot;)
&nbsp; c3 = FrameEvaluate(c2, &quot;t = String(text)&quot;)
&nbsp; c4 = FrameEvaluate(c3, &quot;text = YDifferenceFromPrevious(<b>w</b>)&quot;)
&nbsp; return c4
}

g(v)</pre>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Esta cadeia de filtro trabalha assim:</span>
<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Quando Vdub pede um quadro, AviSynth pede outro
de g().</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">g() pede um de AviSource():</span></li>

<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">AviSynth pede um quadro do segundo FrameEvaluate.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O segundo FrameEvaluate avalia <i>YDifferenceFromPrevious(w)</i>
e designa este valor para a variável<i> text</i>, depois de pedir um quadro do
AviSource. Depois deste um quadro é pedidO do primeiro FrameEvaluate.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O primeiro FrameEvaluate pede um quadro de
ScriptClip, depois a avaliação de<i>String</i>(text) e designando este valor
à variável <i>t'</i>.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">ScriptClip pede um quadro de ConvertToYV12 () e
avalia <i>Subtitle</i>(t) nesse quadro.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">ConvertToYV12() pede um quadro de AviSource().</span></li>
</ul>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">AviSource() produz o quadro e o envia a g(), que
o retorna para Vdub.</span></li>
</ul>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Como pode ser visto, <b>w</b> está definido como
uma variável global. Deste modo podemos usá-lo depois no escrito, no ambiente
condicional. Se nós queremos usar as variáveis <b>t</b> e <b>text</b> em uma
função diferente (dentro ou fora do ambiente condicional), elas também devem
ser definidas como variáveis globais. Assim por exemplo:</span>
<pre>v = AviSource(&quot;E:\Temp\Test3\atomic_kitten.avi&quot;).ConvertToYV12

function g(clip c)
{
&nbsp; global w = c
&nbsp; c2 = ScriptClip(c, &quot;subtitle(<b>t</b>)&quot;)
&nbsp; c3 = FrameEvaluate(c2, &quot;me()&quot;)
&nbsp; c4 = FrameEvaluate(c3, &quot;<b>global</b> <b>text</b> = YDifferenceFromPrevious(w)&quot;)
&nbsp; return c4
}

function me()
{
&nbsp; <b>global</b> <b>t</b> = String(<b>text</b>)
}

g(v)</pre>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Muito do escrito acima é redundante e pode ser
removido. O escrito seguinte produz o mesmo</span>
<pre>v = AviSource(&quot;c:\clip.avi&quot;)
ScriptClip(v, &quot;Subtitle(String(YDifferenceFromPrevious))&quot;)
</pre>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Na seção seguinte alguma info do quadro
dependente será escrita a um arquivo de texto.</span>
<h2>
Filtragem Condicional Avançada: parte II</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">No exemplo seguinte, alguma info do quadro
dependente será escrita num arquivo de texto.A primeira variável &quot;a&quot;
indica se o quadro é pente (a um certo percentual). Note que IsCombed é um
filtro do plugin Decomb. A segunda <span style="mso-spacerun: yes">&nbsp;</span>variável
&quot;b&quot; indica se há muito movimento no quadro.</span></p>
<pre>global sep=&quot;.&quot;
global combedthreshold=25

function IsMoving()
{
global b = (diff &lt; 1.0) ? false : true
}

function CombingInfo(clip c)
{
file = &quot;F:\interlace.log&quot;
global clip = c
c = WriteFile(c, file, &quot;a&quot;, &quot;sep&quot;, &quot;b&quot;)
c = FrameEvaluate(c, &quot;global a = IsCombed(clip, combedthreshold)&quot;)
c = FrameEvaluate(c, &quot;IsMoving&quot;)
c = FrameEvaluate(c,&quot;global diff = 0.50*YDifferenceFromPrevious(clip) + 0.25*UDifferenceFromPrevious(clip) + 0.25*VDifferenceFromPrevious(clip)&quot;)
return c
}

v = mpeg2source(&quot;F:\From_hell\from_hell.d2v&quot;).trim(100,124)
CombingInfo(v)</pre>
<p>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Na seção seguinte um exemplo de &quot;adaptive
motion/resizing filter&quot; - filtro de movimento / redimensionar adaptável -
será considerado.</span></p>
<h2>
Filtragem Condicional Avançada: parte III</h2>

<p>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Alguns filtros de motion/resizing adaptáveis
apareceram nos foros. Estes filtros distinguem movimento em baixo, médio e alto
num clipe (em base de quadro). Ao fazer, diferentes filtros podem ser usados
para cada tipo diferente de movimento no clipe. Em geral, deve-se usar suavização
temporal em cenas de pouco movimento, espacial em cenas de grande movimento e
espacial-temporal em cenas de movimento médio.</span>
<br><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Abaixo, uma versão simplificada de FILTRO de
MOVIMENTO QUANTIFICADO v1.5 b1 (10/07/2003) por HomiE FR, é dado:</span></p>
<pre>----------------------------------------------------
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FILTRO DE MOVIMENTO QUANTIFICADO V1.3</span>
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">CARREGANDO PLUGINS DO AVISYNTH</span>
LoadPlugin(&quot;C:\PROGRA~1\GORDIA~1\mpeg2dec3.dll&quot;)
LoadPlugin(&quot;C:\PROGRA~1\GORDIA~1\TemporalCleaner.dll&quot;)
LoadPlugin(&quot;C:\PROGRA~1\GORDIA~1\FluxSmooth.dll&quot;)
LoadPlugin(&quot;C:\PROGRA~1\GORDIA~1\UnFilter.dll&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">CARREGANDO ESCRITO DE FILTRO DE MOVIMENTO QUANTIFICADO</span>

Import(&quot;E:\temp\QMF\qmf.avs&quot;)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DE FILTRO DE POUCO MOVIMENTO</span>
# -&gt; <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">REDIMENSIONAMENTO AGUÇADO + SÓ TEMPORAL</span>
function Low_Motion_Filter(clip c)
{
&nbsp; c = TemporalCleaner(c, 5, 10)
&nbsp; c = LanczosResize(c, 512, 272)
&nbsp; return c
}

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DE FILTRO DE MÉDIO MOVIMENTO</span>
# -&gt; <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">REDIMENSIONAMENTO BICÚBICO NEUTRO + TEMPORAL &amp; ESPACIAL</span>
function Medium_Motion_Filter(clip c)
{
&nbsp; c = FluxSmooth(c, 7, 7)
&nbsp; c = BicubicResize(c, 512, 272, 0.00, 0.50)
&nbsp; return c
}

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DE FILTRO DE GRANDE MOVIMENTO</span>
# -&gt; <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">REDIMENSIONAMENTO SUAVE + SÓ ESPACIAL</span>
function High_Motion_Filter(clip c)
{
&nbsp; c = FluxSmooth(c, -1, 14)
&nbsp; c = UnFilter(c, -30, -30)
&nbsp; c = BilinearResize(c, 512, 272)
&nbsp; return c
}

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">ABRINDO FONTE DE VÍDEO</span>
AviSource(&quot;E:\temp\QMF\britney-I_love_rock_'n_roll.avi&quot;)
ConvertToYV12(interlaced=true)
Telecide(0)

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">APLICANDO FILTRO DE REDIMENSIONAMENTO ADAPTÁVEL (USANDO QMF)</span>
QMF()
----------------------------------------------------

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FILTRO DE MOVIMENTO QUANTIFICADO (17/08/2003) por HomiE FR</span><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA"> (</span><span lang="EN-US" style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:EN-US;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA"><a href="mailto:homie.fr@wanadoo.fr"><span lang="PT-BR" style="mso-ansi-language:PT-BR">homie.fr@wanadoo.fr</span></a></span><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;
mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:&quot;Times New Roman&quot;;
mso-ansi-language:PT-BR;mso-fareast-language:PT-BR;mso-bidi-language:AR-SA">)</span>
# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DE ESTIMAÇÃO DE MOVIMENTO</span>
function ME()
{
&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FIXANDO NÍVEL DE MOVIMENTO DE ACORDO COM A DIFERENÇA DA MÉDIA [1]</span>
&nbsp; <b>global motion_level</b> = (<b>diff</b> &lt; threshold_lm) ? 0 : motion_level
&nbsp; <b>global motion_level</b> = (<b>diff</b> &gt;= threshold_lm &amp;&amp; <b>diff</b> &lt;= threshold_hm) ? 1 : motion_level
&nbsp; <b>global motion_level</b> = (<b>diff</b> &gt; threshold_hm) ? 2 : motion_level
}

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DO </span><span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FILTRO DE MOVIMENTO QUANTIFICADO</span>
function QMF(clip c, float &quot;threshold_lm&quot;, float &quot;threshold_hm&quot;, bool &quot;debug&quot;)
{
&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FIXANDO PERCENTUAIS DE NÍVEIS DE MOVIMENTO [2]</span>
&nbsp; threshold_lm = default(threshold_lm, 4.0)
&nbsp; threshold_hm = default(threshold_hm, 12.0)
&nbsp; global threshold_lm = threshold_lm
&nbsp; global threshold_hm = threshold_hm

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">ATIVANDO/DESATIVANDO INFORMAÇÃO DE DEBUG [3]</span>
&nbsp; debug = default(debug, false)

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">INICIALIZANDO NÍVEL DE MOVIMENTO</span>
&nbsp; global motion_level = 0

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FIXANDO PRESENTE CLIPE [4]</span>
&nbsp; global clip = c

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">PEGANDO A RESOLUÇÃO DA PRODUÇÃO [5]</span>
&nbsp; width = Width(Low_Motion_Filter(c))
&nbsp; height = Height(Low_Motion_Filter(c))
&nbsp; global c_resized = PointResize(c, width, height)

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">APLICANDO O FILTRO DE MOVIMENTO DE ACORDO COM O NÍVEL DE MOVIMENTO [6]</span>
&nbsp; c = ConditionalFilter(c, Low_Motion_Filter(c), c_resized, &quot;<b>motion_level</b>&quot;, &quot;=&quot;, &quot;0&quot;)&nbsp; # [6a]
&nbsp; c = ConditionalFilter(c, Medium_Motion_Filter(c), c, &quot;<b>motion_level</b>&quot;, &quot;=&quot;, &quot;1&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # [6b]
&nbsp; c = ConditionalFilter(c, High_Motion_Filter(c), c, &quot;<b>motion_level</b>&quot;, &quot;=&quot;, &quot;2&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # [6c]

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">IMPRIMINDO A INFORMAÇÃO DE DEBUG [7]</span>
&nbsp; c = (debug == true) ? ScriptClip(c, &quot;Debug()&quot;) : c

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">PEGANDO O NÍVEL DE MOVIMENTO POR ESTIMAÇÃO DE MOVIMENTO [8]</span>
&nbsp; c = FrameEvaluate(c, &quot;ME()&quot;)

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">PEGANDO DIFERENÇAS ENTRE QUADROS PASSADOS/PRESENTES [9]</span>
&nbsp; c = FrameEvaluate(c, &quot;<b>global diff</b> = 0.50*YDifferenceFromPrevious(clip) + 0.25*UDifferenceFromPrevious(clip) + 0.25*VDifferenceFromPrevious(clip)&quot;)
&nbsp; return c
}

# <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">FUNÇÃO DE INFORMAÇÃO DE DEBUG</span>
function Debug(clip c)
{
&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">IMPRIMINDO A INFORMAÇÃO DA VERSÃO [10]</span>
&nbsp; c = Subtitle(c, &quot;Quantified Motion Filter&quot;, x=20, y=30, font=&quot;lucida console&quot;, size=18, text_color=$FFFFFF)
&nbsp; c = Subtitle(c, &quot;by HomiE FR (homie.fr@wanadoo.fr)&quot;, x=20, y=45, font=&quot;lucida console&quot;, size=14, text_color=$FFFFFF)

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">IMPRIMINDO A INFORMAÇÃO DA ESTIMAÇÃO DE MOVIMENTO [11]</span>
&nbsp; c = Subtitle(c, &quot;motion estimation&quot;, x=20, y=85, font=&quot;lucida console&quot;, size=18, text_color=$FFFFFF)
&nbsp; c = Subtitle(c, &quot;diff = &quot;+string(<b>diff</b>), x=20,y=110, font=&quot;lucida console&quot;, size=16, text_color=$FFCCCC)

&nbsp; # <span style="font-size: 10.0pt; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: Times New Roman; mso-bidi-font-family: Times New Roman; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">IMPRIMINDO A INFORMAÇÃO DO FILTRO DE MOVIMENTO QUANTIFICADO [12]</span>
&nbsp; c = Subtitle(c, &quot;quantified motion filter&quot;, x=20, y=135, font=&quot;lucida console&quot;, size=18, text_color=$FFFFFF)
&nbsp; c = (<b>motion_level</b> == 0) ? Subtitle(c, &quot;scene type = low motion&quot;, x=20, y=160, font=&quot;lucida console&quot;, size=16, text_color=$66FF66) : c
&nbsp; c = (<b>motion_level</b> == 1) ? Subtitle(c, &quot;scene type = medium motion&quot;, x=20, y=160, font=&quot;lucida console&quot;, size=16, text_color=$66FF66) : c
&nbsp; c = (<b>motion_level</b> == 2) ? Subtitle(c, &quot;scene type = high motion&quot;, x=20, y=160, font=&quot;lucida console&quot;, size=16, text_color=$66FF66) : c
&nbsp; return c
}
----------------------------------------------------</pre>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Esta cadeia de filtro trabalha assim:</span>
<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Quando Vdub pede um quadro, AviSynth pede outro
de QMF.</span></li>

<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">QMF pede um quadro de FrameEvaluate [9].</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Depois de fazer este escrito [9] é avaliado e a
variável global <i>diff</i> <span style="mso-spacerun: yes">&nbsp;</span>é
nomeada depois de pedir um quadro de AviSource. FrameEvaluate [9] pede um quadro
de FrameEvaluate [8].</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Uma vez mais o escrito [8] é avaliado:</span></li>

<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">ao avaliar me(), a variável global <i>motion_level</i>
é nomeada para aquele quadro [1]</span></li>
</ul>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se debug=true, um quadro é pedido de ScriptClip
[7] e do Debug().</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Depois disso (e também quando debug seja <i>false</i>)
um quadro é pedido do último ConditionalFilter [6c] que pede um quadro de
[6b], o qual em troca pede um de [6a].</span></li>

<ul>
<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Note que no fim, um quadro de High_Motion_filter,
Medium_Motion_filter, ou Low_Motion_filter é pedido, dependendo do valor de <i>motion_level</i>.</span></li>
</ul>
</ul>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">QMF pede um quadro de Telecide, Telecide de
ConvertToYV12 e finalmente ConvertToYV12 de AviSource.</span></li>

<li>
<span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">AviSource produz o quadro e o envia a
ConvertToYV12, etc.</span></li>
</ul>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Foram omitidos alguns detalhes, mas isto é
basicamente como o escrito trabalha.</span>
</p>
<kbd>$Date: 2006/03/26 18:11:19 $ Portuguese translation by RoLon</kbd>
<form><input TYPE="Button" VALUE="Back"
onClick="history.go(-1)"></form>
</body>
</html>
