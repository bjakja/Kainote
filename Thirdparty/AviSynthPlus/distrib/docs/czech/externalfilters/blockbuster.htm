<html>
<head>
<title>Blockbuster</title>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: blockbuster.htm,v 1.1 2010/02/27 14:50:14 wilbertd Exp $
-->
</head>
<body>
<h1>Blockbuster</h1>
<h2>Pøehled</h2>
<b>autor:</b> Ross Thomas
<br><b>verze:</b>  0.7<br>
<b>stáhnout:</b> <a href="http://kvcd.net/sansgrip/avisynth/">http://kvcd.net/sansgrip/avisynth/</a>,
<a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a><br>
<b>kategorie:</b> Rùzné pluginy<br>
<b>poadavky:</b> YV12 &amp; YUY2 Barevné prostøedí
<hr>
<h2>Popis</h2>
Blockbuster je Avisynth filtr navrenı pro sníení nebo eliminaci DCT blokù
			z komprimovanıch materiálù. Kdy se DCT bloky, také známé jako "temné bloky" (èesky kostkatìní)
			objeví v oblastech nízkého jasu (luma) snímku, jsou to ošklivé, rozptylující artefakty které MPEG enkodéry
			rádi volnì rozptylují v našich jinak bezchybnıch kompresích.
		<p>Zatímco se závanost problému mìní s rùznımi verzemi MPEG,
			u MPEG-1 ukazuje nejvíce DCT blokù a MPEG-4 nejménì, vyskytují se
			ve všech verzích. MPEG-1 je produkuje témìø kdekoli kde je rovinná plocha
			s nízkou úrovní detailù (jako zeï), a MPEG-2 je zobrazuje ve stejnıch oblastech,
			ale ménì èasto (jsou  v zásadì vidìt pøi niších datovıch tocích, jak si mùe
			kadı kdo má zkušenosti s digitálním vysíláním ovìøit). MPEG-4 má vıraznì ménì
			problémù s nízkımi úrovnìmi detailù, ale stále produkuje DCT bloky,
			obzvláštì v tmavıch oblastech (viz. <a target="_blank" href="http://forum.doom9.org/showthread.php?s=&amp;threadid=31301">
				toto vlákno na Doom9</a> pro více informací o tìchto blocích a MPEG-4).</p>
		<p>(Ostatnì, DCT sznamená "discrete cosine transform - diskrétní kosinová transformace", a je jednou z
			technik MPEG pouívanıch k provádìní komprese. Liší se od makroblokù, které
			jsou nejviditelnìjší v oblastech s vysokım pohybem, kdy je nedostateènı datovı tok pro
			pøesnı popis pohybu, a také od "mosquito" šumu, kterı je
			artefaktem, kterı se objevuje kolem hran a oblastí s vysokım kontrastem.)</p>
		<p>Jak je uvedeno vıše, pøíèinou tìchto blokù se zdá bıt nedostatek detailù v
			oblastech obrazu, které enkodér "pøehlédne" a proto pouije pøíliš silnou
			kompresi. Ve zpracování byly detaily vyhlazeny a
			oblast se mìní na DCT blok.</p>
		<p>Cílem tohoto filtru je pokusit se vytvoøit takové oblasti více "viditelné" pro
			enkodér, take jim pøiøadí více bitù a tak nepotøebuje tolik komprimovat.
			Ti vychytralí mezi vámi si uvìdomí, e tento filtr je v podstatì navren
			pro zvıšení datového toku (a sníení komprimovatelnosti) vašeho klipu. Ale to je
			pro vìtšinu kardinální høích, take zde jsou alespoò dva pádné dùvody
			pro jeho pouití.</p>
		<p>Za prvé, zatímco nejvyšší monı kompresní pomìr je samozøejmì ádoucí, èlovìk
			musí zváit cenu. Nikdo by nepøijal video s rozlišením
			120x90, dokonce kdy kadı ví, e by to mìlo vıbornı kompresní pomìr.
			Podobnı efekt by byl dosaen vyhlazováním klipu dokud nebude vypadat
			jako by jste zapatlali monitor vazelínou, ale znovu by nikdo nepøijal takovı
			obraz.</p>
		<p>Mohlo by se argumentovat, e DCT bloky jsou podobnì neakceptovatelné v kompresích
			dobré kvality. Názor lidí na to se hodnì liší, ale zvyšující se poèet,
			vèetnì mì,  hledají jistı zpùsob jak je vyèistit. Tento
			filtr je mım pøíspìvkem k této snaze.</p>
		<p>Za druhé, protoe se kompresní technologie vyvíjí a zlepšuje, je obèas nutné
			pøekódovat stará videa na nové, pokroèilejší formáty. Odstranìní artefaktù
			z existujících videí je mnohem obtínìjší ne zastavení jejich vıskytu v první fázi.
			Tedy odstranìní DCT blokù z vašich enkódování nyní usnadní
			rekompresi vašich videí pozdìji.</p>
		<h2>Jak pracuje</h2>
		<p>Filtr rozdìluje kadı snímek na série blokù (uivatelsky konfigurovatelnıch
			rozmìrù) a kontroluje postupnì kadı blok na mnoství detailù, které obsahuje.
			Pokud je úroveò detailù uvnitø definovaného rozsahu pak je blok zpracován
			v souladu s parametrem <i>method</i> (viz. èást <a href="#usage">Pouití</a> níe).</p>
		<h2><a name="usage"></a>Pouití</h2>
		<p>Existuje nìkolik metod, které mohou potenciálnì sníit nebo eliminovat DCT bloky:
			pøidání šumu, zostøení, a rozmazání. Tyto rùzné pøístupy jsou pøipojovány
			pomocí parametru <i>method</i> , kombinovaném sadou parametrù sdílenıch
			všemi metodami stejnì jako parametry specifickımi pro kadou z nich. Je také doplòková
			metoda zvaná "show" která zvırazní kadı blok, kterı bude ovlivnìn
			filtrem.</p>
		<p>Obecná forma jeho pouití je</p>
		<blockquote>
			<p><code>Blockbuster</code> (<var>clip, method="...", sdílené parametry, parametry specifické pro metodu</var>)
			</p>
		</blockquote>
		<p>Parametr <var>method</var> mùe bıt buï "noise", "dither", "sharpen", "blur"
			nebo "show". Parametry specifické pro kadou metodu budou uvedeny v kapitole <a href="#methods">
				Metody</a> níe. Parametry bìné pro všechny metody jsou:</p>
		<table border="1">
			<tr>
				<th>
					Parametr</th>
				<th>
					Popis</th>
				<th>
					Vıchozí</th>
			</tr>
			<tr>
				<td><i>block_size</i></td>
				<td>Urèuje velikost blokù na které je kadı snímek rozdìlen pøed zpracováním.
					Hodnota reprezentuje jak šíøku tak vıšku bloku, a
					nemùe bıt menší ne 3.</td>
				<td>8</td>
			</tr>
			<tr>
				<td><i>detail_min</i>, <i>detail_max</i></td>
				<td>
					<p>Urèuje mnoství detailù, které musí bıt pøítomno v bloku, aby byl zpracován.
						Tato hodnota je procentuální, a mùe bıt mezi 1 a 100.
						Reprezentuje procento unikátních úrovní svìtlosti (jasu)) uvnitø bloku.</p>
					<p>Napøíklad, pokud <i>block_size</i> je nastaven na 8, kadı blok obsahuje 64 pixelù. Pokud <i>detail_min</i>
						je 1 a <i>detail_max</i> je 50, blok bude zpracován jen, kdy obsahuje
						mezi 1 a 32 unikátními úrovnìmi svìtlosti.</p>
					<p>Nastavení <i>detail_min</i>=1, <i>detail_max</i>=100 zpracuje celı snímek.</p>
				</td>
				<td>
					<p><i>detail_min</i>=1, <i>detail_max</i>=10</p>
				</td>
			</tr>
			<tr>
				<td><i>luma_offset</i>, <i>luma_threshold</i></td>
				<td>
					<p>Jasové pixely v rozsahu 0-<i>luma_threshold</i> budou posunuty o <i>luma_offset</i>
						uvnitø zpracovanıch blokù.</p>
					<p>Napøíklad, pokud je <i>luma_threshold</i> 30 a <i>luma_offset</i> je -2, tmavé
						pixely (ty s jasem mezi 0 a 30 vèetnì) budou zmenšené o 2,
						 a tím ještì mírnì ztmavené.</p>
					<p>(Zdùvodnìní: Bylo objeveno, e parametr <i>lumoff</i> pluginu mpeg2dec od Marc FD
						jak se zdá sniuje objevování MPEG-4 "tmavıch blokù" -- DCT bloky v tmavıch oblastech
						snímku -- dále. Tyto parametry jsou vytvoøeny pro provádìní stejné vìci,
						ale omezují zmìnu svìtlosti jen na oblasti, které vypadají, e to potøebují.)</p>
				</td>
				<td><i>luma_offset</i>=0, <i>luma_threshold</i>=25</td>
			</tr>
		</table>
		<h2><a name="methods"></a>Metody</h2>
		<h3>method="noise"</h3>
		<p>Tato metoda pøidává normálnì šíøenı -- také známı jako Gaussùv
			-- šum do klipu. Testování ukázalo, e Gaussùv šum je daleko
			vhodnìjší pro úèely tohoto filtru, ne uniformnì šíøenı šum.</p>
		<p>S unifirmì šíøenım šumem je kadá moná hodnota stejnì pravdìpodobná jako jiná.
			To je, pokud generujete sekvenci èísel v rozsahu 1-100,
			v jakémkoli bodì sekvence asi vygenerujete 5 stejnì jako 95.</p>
		<p>"Normální šíøení" znamená, e šance, e se objeví kadá hodnota není stejná.
			Øeknìme, e generujete normálnì šíøená èísla se støedem v 0 a
			variací 1 (pro vysvìtlení tìchto termínù viz odkazy na konci
			paragrafu). Generátor mùe teoreticky vyplivnout <i>jakékoli</i> èíslo, které mùe
			mít dvì desetinná místa, ale bráno v celku èísla budou v prùmìru nula
			(to je to co znamená mean=0). S tìmito parametry
			asi 68% hodnot bude mezi -1 a 1, kolem 95% mezi -2 a 2,
			a kolem 99% mezi -3 a 3. Pravdìpodobnost generování èísel, která jsou
			vıraznì vyšší nebo niší je opravdu velmi malá, proti pravdìpodobnosti získání
			malıch hodnot dále od nuly. Potøebovali by jste vytvoøit miliardy
			Gaussovıch náhodnıch èísel se støedem v 0, rozdílem 1 ne by jste napøíklad uvidìli vygenerovanou
			hodnotu 9. Mùete si pøeèíst více o normálním rozloení <a href="http://www.robertniles.com/stats/stdev.shtml">
				zde</a> a <a href="http://davidmlane.com/hyperstat/A16252.html">zde</a>.</p>
		<p>Gaussùv šum velmi tíhne koncentrovat kolem zadaného støedu, a je
			tak více "pøírodní" ne uniformnì rozšíøenı šum. Vìtšina vìcí v pøírodì
			(vèetnì jarních sráek, kalorickıch pøíjmù, a samozøejmì šumu)
			se shlukuje kolem "normální" hodnoty, s postupnì ménì èastımi vıskyty
			èím dále se dostáváte od normálu.</p>
		<p>
			O pøidání šumu pro eliminaci DCT blokù si mùete pøeèíst více na <a href="http://arstechnica.infopop.net/OpenTopic/page?a=tpc&amp;s=50009562&amp;f=67909965&amp;m=3890938134&amp;r=5470927074">
				tomto vláknì Ars Technica</a> (upraveno Wilbertem: U nemùu najít
            pøíslušné vlákno).</p>
		<blockquote>
			<p><code>Blockbuster</code> (<var>clip, method="noise", bìné parametry, float
            &quot;mean&quot;,
				float &quot;variance&quot;, int &quot;cache&quot;, int &quot;seed&quot;</var>)</p>
		</blockquote>
		<table border="1">
			<tr>
				<th>
					Parametr</th>
				<th>
					Popis</th>
				<th>
					Vıchozí</th>
			</tr>
			<tr>
				<td><var>mean</var>, <var>variance</var></td>
				<td>Støed a zmìna generovaného náhodného šumu.</td>
				<td><var>mean</var><EM> </EM>= 0, <var>variance</var> <EM> </EM>=
                  1</td>
			</tr>
			<tr>
				<td><var>cache</var></td>
				<td>
					<p>Protoe generování Gaussovıch èísel je velmi pomalé, pro dosaení rozumného
						vıkonu Blockbuster vytváøí vyrovnávací pamì náhodnıch èísel pøi startu. Tento
						parametr zadává velikost vyrovnávací pamìti v kilobajtech. I kdy mùete nastavit tuto
						hodnotu na jakékoli kladné èíslo, je nejlepší ji dret docela velkou, aby
						se udroval øádnı náhodnı šum.</p>
					<p>I kdy se mùe zdát vıchozí hodnota dost velká, uvate toto: Pokud máte velikost bloku
						8, pak kadı blok má oblast 64 pixelù. Kadı pixel vyadje 2 bajty pro svùj popis
						take zpracovanı blok spotøebuje 128 bajtù náhodnıch dat. Pokud 10%
						blokù ve snímu 640x480 je zpracováno, bude to vyadovat pøiblinì 62kb
						náhodnıch èísel.</p>
				</td>
				<td>256</td>
			</tr>
			<TR>
				<TD><var>seed</var></TD>
				<TD>
					<P>Ve vıchozím stavu pseudogenerátor náhodnıch èísel, pouije systémovı aktuální èas
						jako svou základní hodnotu. Pro urèuté aplikace, kde jsou poadovány pøedpovìditelné vısledky
						mùe bıt parametr <var>seed</var> pouit pro pøepsání této vıchozí hodnoty,
						a tak poskytuje stejnì "náhodnı" šum v kadém èase, kdy filtr bìí.</P>
					<P>Seed mùe bıt jakékoli èíslo od 0 do 2,147,483,647. Kdy je, pouije se
						systémovı aktuální èas.</P>
				</TD>
				<TD>0</TD>
			</TR>
		</table>
		<h3>method="dither"</h3>
		<P>Tato metoda je velmi podobná metodì "noise" , jen s tím rozdílem, e
			tato metoda pøidá stejnı šum do kadého snímku klipu, kdeto metoda
			"noise" pøidá jinı šum do kadého snímku. Efekt tohoto
			se tìko popisuje, ale snadnìji se vidí, take zkuste si ho s vysokım
			parametrem variance. Nejbliší porovnání, které mì napadá je, e tato metoda vytváøí
			efekt podobnı sledování videa pøes skvrnité sklo.</P>
		<P>Dùvod proè jsem pøidal tuto metodu je, e jsem shledal pøi pouití <var>method</var>
        = &quot;noise&quot; e
			konstantnì mìnící se povaha šumu vytváøela pohyb v jinak statickıch
			oblastech snímku, obzvláš pøi pouití nízkého datového toku. Je mou nadìjí, e
			pouití stejného šumu pro kadı snímek zabrání artefaktovému pohybu ve statickıch
			oblastech. Mìlo by to bıt povaováno za experimentální.</P>
		<BLOCKQUOTE dir="ltr" style="MARGIN-RIGHT: 0px">
			<P><code>Blockbuster</code> (<var>clip, method="dither", bìné parametry, float
            &quot;mean&quot;,
				float &quot;variance&quot;, int &quot;seed&quot;</var>)</P>
		</BLOCKQUOTE>
		<P dir="ltr">Na popis parametrù této metody, se podívejte na metodu "noise"
			vıše. Nicménì si všimnìte, e metoda "dither" nemá parametr <var>cache</var>
			protoe generuje jen šum pro jeden snímek.</P>
		<H3>method="sharpen"</H3>
		<p>Tato metoda aplikuje základní (a rychlı) zostøovací filtr na zpracovávané bloky.
			Takto "zesiluje" u pøítomnı detail v bloku radìji ne aby pøidával
			novı šum.</p>
		<blockquote>
			<p><code>Blockbuster</code> (<var>clip, method="sharpen", bìné parametry, int
            &quot;strength&quot;</var>)</p>
		</blockquote>
		<table border="1">
			<tr>
				<th>
					Parametr</th>
				<th>
					Popis</th>
				<th>
					Vıchozí</th>
			</tr>
			<tr>
				<td><var>strength</var></td>
				<td>Zadává sílu zostøování, od 1-100.</td>
				<td>25</td>
			</tr>
		</table>
		<h3>method="blur"</h3>
		<p>Tato metoda aplikuje rozmazání 3x3 na zpracovávané bloky. V souèasnosti je
			experimentální, protoe teoreticky sniování frekvence u tak nízkofrekvenèních blokù
			nesníí vzhled DCT blokù. Ale stojí to za pokus
			:).</p>
		<blockquote>
			<p><code>Blockbuster</code> (<var>clip, method="blur", bìné parametry, int
            &quot;strength&quot;</var>)</p>
		</blockquote>
		<table border="1">
			<tr>
				<th>
					Parametr</th>
				<th>
					Popis</th>
				<th>
					Vıchozí</th>
			</tr>
			<tr>
				<td><var>strength</var></td>
				<td>Zadává sílu rozmazání, od 1-100.</td>
				<td>25</td>
			</tr>
		</table>
		<h3>method="show"</h3>
		<p>Tato metoda zvırazòuje bloky, které budou zpracovány pouitím zadanıch
			bìnıch parametrù blokù (<i>block_size</i>, <i>detail_min</i>, a <i>detail_max</i>).
			Je hlavnì uiteèná jako vizuální pomoc v nastavení prahovıch hodnot detailu na poadovanı
			rozsah.</p>
		Tato metoda nemá doplòkové parametry.
		<h2>Na dopracování</h2>
		<ul>
			<li>
			MMX/SSE optimalizace (Napøed musím nastudovat x86 assembler...).
			<li>
				Metoda unsharp mask.</li>
		</ul>
<h2>Autor</h2>
<p>Ross Thomas &lt;ross(at)grinfinity.com&gt;</p>
<p><kbd>$English Date: 2004/08/13 21:57:25 $</kbd></p>
<p><kbd>Èeskı pøeklad:7.5.2009</kbd></p>
	</body>
</html>
