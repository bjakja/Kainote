<html>
<head>
<title>DeScratch Plugin for Avisynth</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: descratch.htm,v 1.1 2010/02/27 14:50:14 wilbertd Exp $
-->
</head>

<body>
<h1>DeScratch</h1>
<h2>Pøehled</h2>
<b>autor:</b>  Alexander G. Balachnin aka Fizick<br>
<b>verze:</b>       0.9.0.0<br>
<b>stáhnout:</b>  <a href="http://avisynth.org.ru/">http://avisynth.org.ru/</a>,
<a href="http://avisynth.org/warpenterprises/">http://avisynth.org/warpenterprises/</a> <br>
<b>kategorie:</b>   Pluginy pro vysílané video<br>
<b>poadavky:</b> YV12 Barevné prostøedí<hr>
<h3>Úèel</h3>
Tento plugin  odstraòuje vertikální škrábance z filmù. Také mùe bıt
pouit pro odstraòování horizontálních šumovıch èar, jako pøi vıpadku signálu
z analogovıch VHS nahrávek (po rotaci obrazu).
<h3>Jak pracuje</h3>
<p>Plugin nejdøív detekuje škrábance, pak je odstraní.<br>
Pracuje na kadém snímku, pouívá prostorovou informaci jen z aktuálního snímku.<br>
Adaptoval jsem ho pro restauraci mıch starıch 8 mm filmù, moná bude uiteènı ještì nìkomu.</p>
<h4>Detekce škrábancù</h4>
<p>Pouije nìjaké vertikální rozmazání na kopii snímku, pro potlaèení tenké struktury obrazu, šikmıch èar a šumu.<br>
Hledá lokální extrémy jasu (luma) v kadé øádku, s kritériem rozdílu jasu.<br>
Vloí tyto extrémy do nìjaké mapy (snímku).<br>
Volitelnì zavøe vertikální mezery v extrémech vertikálním rozšíøením extrémních bodù.<br>
Testuje mapu extrémù s kritérii délky a úhlu, a tak vybere jen skuteènì dlouhé škrábance.</p>
<h4>Odstranìní škrábancù</h4>
<p>Škrábance mohou bıt buï èásteènì prùhledné, hladké (s detaily obrazu), nebo neprùhledné (bez detailù nebo s témìø znièenımi).<br>
V prvním pøípadì plugin mùe odeèíst hladkou (rozmazanou) èást variace jasovıch škrábancù od pùvodního obrazu. Detaily obrazu tedy zùstanou zachovány.<br>
V druhém pøípadì plugin nahrazuje poškrábané pixely støedními hodnotami jasu z nìkterıch sousedních pixelù (v nìkterıch øádcích).<br>
Mùeme mít také prostøední pøípad, nastavením nìjakého procenta detailù pro zachování.<br>
Plugin má urèitou adaptaci mnoství zachovanıch hodnot (detailù) v souladu s rozdílem jasu pixelù.<br>
Ve všech pøípadech se pro hladší pøechody mohou èásteènì zmìnit i nìkteøí nejbliší sousedé.</p>
<h3>Potøebnı software</h3>
<p>Program je plugin (filtr) pro Avisynth 2.5.<br>
Testován je s verzí 2.55beta (nìkteré verze mají chybu pøi Turnleft()! ).<br>
Verze filtru nad 0.2 u nepotøebují Avisynth C rozhraní (avithynth_c.dll) od Kevina Atkinsona.<br>
Kompilovano v MS VC++ Toolkit 2003.</p>
<h3>Syntaxe</h3>
<p><code>DeScratch</code>(<var>int mindif, int asym, int maxgap, int maxwidth, int minlen, int maxlen, int maxangle, int blurlen, int keep, int border,
int modeY, int modeU, int modeV, int mindifUV, bool mark</var>)</p>
<p>Všechny parametry jsou jmenné a volitelné.</p>
<h3>Parametry pluginu</h3>
<p><var>mindif</var> - minimální rozdíl hodnoty pixelu ve škrábanci od sousedních pixelù v jasové ploše<br>
&nbsp;&nbsp;&nbsp; (od 1 do 255, vıchozí 5):<br>
<var>asym</var> - maximální asymetrie sousedních pixelù (od 0 do 255, vıchozí 10)<br>
<var>maxgap</var> - maximální uzavírací vertikální mezera (od 0 do 255, vıchozí 3)<br>
<var>maxwidth</var> - maximální šíøka škrábance (1 nebo 3, vıchozí=3)<br>
<var>minlen</var> - minimální délka škrábance (vıchozí = 100)<br>
<var>maxlen</var> - maximální délka škrábance (vıchozí = 1000)<br>
<var>maxangle</var> - maximální úhel od vertikály (ve stupních, vıchozí = 5)<br>
<var>blurlen</var> - rádius vertikálního rozmazání pro analızu snímku (vıchozí = 15)<br>
<var>keep</var> - procento zachovávanıch detailù ze škrábancù (vıchozí = 100)<br>
<var>border</var> - tlouška okraje kolem škrábance pro èásteènou restauraci (vıchozí = 2)<br>
<var>modeY</var> - reim zpracování jasové (luma) plochy (0 - ne, 1 - nízké(èerné), 2 - vysoké(bílé), 3 - oba, vıchozí=1)<br>
<var>modeU</var> - reim zpracování barevné (chroma) U plochy (0 - ne, 1 - nízké(zelené), 2 - vysoké (èervené), 3 - obì, vıchozí=0)<br>
<var>modeV</var> - reim zpracování barevné (chroma) V plochy (0 - ne, 1 - nízké(luté), 2 - vysoké(modré), 3 - obì, vıchozí=0)<br>
<var>mindifUV</var> - minimlní rozdíl hodnoty pixelu ve škrábanci od sousedních pixelù pro barevnostní (chroma) plochy<br>
&nbsp;&nbsp;&nbsp; (od 0 do 255, vıchozí 0):<br>
&nbsp;&nbsp;&nbsp; pokud je = 0, pak vnitøní hodnota <var>mindifUV</var> je stejná jako <var>mindif</var>.<br>
<var>mark</var> - oznaèí škrábanec v ladícím (debug) reimu (true nebo false, vıchozí = false)<br>
&nbsp;&nbsp;&nbsp; (nastavuje vylouèené extrémní pixely na šedé, nastavuje pixely škrábancù na bílé nebo èerné)</p>
<p>
<var>maxgap</var>, <var>maxwidth</var>, <var>minlen</var>, <var>blurlen</var>, <var>border</var>
by mìli bıt zadány v pixelech.</p>
<p>MUSÍTE vyladit parametry pro vaše konkrétní video.<br>
Pouijte pøíkazy AviSynthu <code>Greyscale(), UtoY(), VtoY()</code>, a parametr <var>mark</var> pro vyladìní a nastavení.</p>
<h3>
Pøíklady</h3>
<p>
Starı poškrábanı 8 mm film. Horní polovina snímku - pøed filtrem, spodní polovina snímku - po filtru</p>
<p><img border="0" src="../../english/pictures/externalfilters/descratch1.jpg" width="720" height="576"></p>
<h4>Pøíklad skriptu pro Avisynth (pouitı pro klip uvedenı vıše):</h4>
<pre>AviSource(&quot;input.avi&quot;)
LoadPlugin(&quot;descratch.dll&quot;)
ConvertToYV12()
DeScratch(mindif=2)</pre>
<h3>Odstraòování horizontálních šumovıch èar</h3>
<p>Takové dlouhé šumové èáry se obèas objeví v analogovém zachytávaném materiálu (vypuštìní TV nebo VHS øádkù, atd).
Tento problém byl diskutovanı na Doom9, viz. èlánek <a href="http://www.doom9.org/capture/descratch.html"> <cite> Removal of clicks and scratches</cite></a>
(July 10-31, 2004).
Ale ve èlánku se nejdøíve pouíval plugin DeSpot, co pro toto není nejvhodnìjší nástroj, kvùli velmi slabé úrovni šumu.
DeScratch by mohl bıt efektivnìjší, nicménì také není ideální (staré verze mohou zpracovávat jen jasovou plochu).
Samozøejmì musíte pro zpracování pomocí Descratch otoèit (rotovat) klip (a nezapomenout po vyèištìní otoèit zpìt :-).</p>
<p>Podívejte se na vısledky v nìkterıch VHS zdrojích (od <b>Ivo</b>).<br>
Horní polovina snímku - pøed zpracováním , spodní polovina snímku - po zpracování:</p>
<p><img border="0" src="../../english/pictures/externalfilters/descratch2.jpg" width="768" height="576"></p>
<h4>    Skript pouitı pro pøípad VHS klipu</h4>
<pre>LoadPlugin(&quot;descratch.dll&quot;)
AviSource(&quot;drop-outs_.avi&quot;)
ConvertToYV12()
Crop(0,0,-0,288) # vybere horní èást snímku pro ušetøení plochy motitoru
input=last
AssumeTFF()
SeparateFields() # pro analogovı prokládanı zdroj
TurnLeft()
DeScratch(mindif=4, maxgap=20, minlen=300, blurlen=50, keep=100, border=0, maxangle=0)
TurnRight()
Weave() # obnoví pole
StackVertical(input, last) # Porovná zdrojovı snímek a snímek po odstranìní škrábancù</pre>
<p>Byly pouité optimální parametry Descratch - velké <var>minlen</var>, nulovı <var>maxangle</var>):</p>
<p>Pro odstranìní šumu po vypuštìnıch barevnıch øádcích mùete pouít reimy <var>modeU</var>, <var> modeV</var> a
<var> mindifUV</var>.</p>
<h3>Více informací</h3>
<p>Podívejte se na doom9 Avisynth fórum, vlákno <a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=67794">
<cite>http://forum.doom9.org/showthread.php?s=&amp;threadid=67794</cite></a></p>
<h3>Licence</h3>
<p>Tento program je FREE software, pod GNU GPL licence v2.
</p>
<h3>Historie verzí:</h3>
<ul>
  <li>Version 0.1, 22 December 2003 - initial beta (not public)</li>
  <li>Version 0.2, 31 December 2003 - first public
    <ul>
      <li>changed to sharp extrems;</li>
      <li>added gaps closing</li>
    </ul>
  </li>
  <li>Version 0.3, July 14, 2004
    <ul>
      <li> ported to native Avisynth plugin</li>
      <li> Speed increased due to fast blurring by Avisynth resizing functions.</li>
    </ul>
  </li>
  <li>Version 0.4, July 17, 2004
    <ul>
      <li>Added chroma processing: <var>modeY, modeU, modeV</var> parameters,</li>
      <li>introduced in version 0.4 after Ivo's request (old versions can process luma only).</li>
      <li><var>mindif</var> is now positive only;</li>
      <li>marked scratches value is not inverted but contrasted now.</li>
    </ul>
  </li>
  <li>Version 0.5, July 31, 2004
    <ul>
      <li>fixed read-write pointer bug,</li>
      <li>add <var>mindifUV</var> parameter for separate control of chroma U,V planes cleaning,</li>
      <li>some code reorganization,</li>
      <li>documentation corrected.</li>
    </ul>
  </li>
  <li>Version 0.6, August 23, 2004 - fixed byte overflow bug (clip output to 0-255)</li>
  <li>Version 0.7, November 15, 2004 - added asymmetry check (<var>asym</var> parameter)</li>
  <li>Version 0.8, March 13, 2005 - added <var>maxlen</var> parameter</li>
  <li>Version 0.9, March 31, 2005 - <var>maxwidth</var> parameter partially unfixed, allowed value =1 or 3 (was 3 only)</li>
  <li>Version 0.9.0, June 15, 2005 - documentation re-formatted</li>
  <li>Version 0.9.0.0, September 09, 2006 - source licensed under GNU GPL v2</li>
</ul>
<h3>Omezení v aktuální verzi:</h3>
<p>Maximální šíøka škrábance je fixována na 1 nebo 3.<br>
Plugin pracuje jen v YV12.</p>
<p><kbd>$English Date: 2006/12/15 19:29:25 $</kbd></p>
<p><kbd>Èeskı pøeklad:26.4.2009</kbd></p>
</body>
</html>
