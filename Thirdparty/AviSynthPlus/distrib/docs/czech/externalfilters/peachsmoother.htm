<html>
<head>
<title>PeachSmoother</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: peachsmoother.htm,v 1.1 2010/02/27 14:50:14 wilbertd Exp $
-->
</head>
<body>
<h1>PeachSmoother</h1>
<h2>Pøehled</h2>
<b>autor:</b>  Lindsey Dubb
<br><b>verze:</b>    1.0c<br>
<b>stáhnout:</b> <a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a>
<br><b>kategorie:</b>   Prostorovì èasové vyhlazovaèe
<br><b>poadavky:</b>  YUY2 Barevné prostøedí
<hr>
        <h2>Úvod</h2>
        <p>Toto je další filtr, kterı oèišuje obraz zprùmìrováním
        vizuálního šumu mezi snímky i uvnitø snímkù.</p>
        <p>Peach je navren tak, aby se vypoøádal se zvláštnostmi TV vysílání.
        Automaticky se sám jemnì vyladí pro dobrou i pro špatnou kvalitu signálu a
        pøíjmu, a mùe se dokonce rozumnì vypoøádat s nìkterımi druhy interferencí.
        Je to ohromné!</p>
        <p>Filtr provìøuje obraz, odvozuje mnoství šumu v obrazu,
        a vyuívá odhad k urèení jak vyrušit tento šum. K
        rozlišení mezi šumem a pohybem, filtr pouívá
        korelací uvnitø i mezi poli, stejnì jako lokálních barevnıch
        rozdílù. Stupeò jistoty o pohybu, šumu, a detailech je
        pouit pro rozhodnutí jakı mix pøedchozích, aktuálních, a okolních barev
        zobrazit.</p>
        <p>Aby jste mohli Peach pouít, musí bıt váš poèítaè schopen pracovat s SSE
        instrukcemi. Èesky to znamená, e budete potøebovat Pentium 3,
        Athlon, novìjší Celeron, nebo nìjakı ještì novìjší procesor.</p>
        <p>Tento filtr pracuje v YUY2 barevném prostøedí. take pokud je váš klip enkódován
        v RGB barvách, budete muset nejdøíve pouít ConvertToYUY2().</p>
        <p>Peach Smoother AVISynth filtr napsal Lindsey Dubb,
        copyright 2002. Pokud máte nìjaké, komentáøe, problémy, nebo
        návrhy, uvítám, kdy mi <a href="mailto:lindsey@alumni.caltech.edu">pošlete
        email</a> nebo napíšete na Doom9 <a href="http://forum.doom9.org/forumdisplay.php?s=&amp;forumid=33">AVISynth
        Fórum</a>.
        <hr>
        <h2>Nastavení</h2>
        <p><var>NoiseReduction</var><br>
        <i>Celé èíslo od 1 do 200; 35 je vıchozí</i></p>
        <p>Obèas filtr neví jestli zmìna v obrazu pochází
        od šumu nebo od pohybu. Kdy to nastane,
        je na vıbìr&nbsp;— pøedpokládat pohyb, a obraz bude šumìjší pokud se
        zmılíte. Nebo pøedpokládat šum, a chyba pak rozmae pohyb.</p>
        <p>Nastavení <var>NoiseReduction</var> vás nechá øíci
        filtru jak se rozhodnout. Nastavte ho nízko, a poèítaè
        bude pracovat bezpeènì, vyhne se všem èástem obrazu s monım pohybem.
        Nastavte ho vysoko, a šum bude vıraznì sníen — za cenu rozmazání
        a ztráty detailù v pomalıch pohybovıch oblastech. Tato volba je
        ovlivnìna mnostvím šumu — èím víc šumu je v obrazu, tím víc ho bude nutné
        rozmazávat aby se redukoval.</p>
        <p>Neexistuje dokonalı zpùsob  jeho vıbìru — prostì zkuste rùzné hodnoty
        a bude vypadat tak hezky jak jen to je moné. Komedie a dramata jsou
        pravdìpodobnì nejlepší materiál pro trefení nastavení, protoe velké zábìry oblièejù
        umoòují opravdu snadno rozeznat rozmazání. (To je proto, e zvláš
        dobøe vidíme poruchy ve tváøích.)</p>
        <p>Pamatujte, e se tento filtr automaticky upravuje na mnoství
        šumu v obrazu. Take jakmile máte nastavení, jaké se vám líbí, mùete ho
        pouít jak pro èisté tak pro zašumìlé video.</p>
        <p>Nicménì, existují dva druhy videa, které si zasluhují trochu zvláštní rozvahy:
        kreslené filmy a sport. U kreslenıch mùete pouít mnohem
        vyšší <var>NoiseReduction</var>, protoe animace
        má sklon mít ménì jemnıch detailù. A u sportu (nebo jiného videa s neustálım
        pohybem) je velmi malı úèinek šumového filtru, take
        ho mùete prostì pøeskoèit.</p>
        <p>Ne jemnì vyladíte toto nastavení, ujistìte se, e je filtr
        schopen odhadnout šum ve vašem klipu. Udìlejte to pouitím parametru <var>Dot</var>,
        popsanım níe.</p>
        <p><var>Stability</var><br>
        <i>Celé èíslo od -100 do 100; 20 je vıchozí</i></p>
        <p>Toto nastavení øíká filtru, jak moc smíchat barvy, kdy není
        jisté, jestli tam je pohyb. Pro zachování malého mnoství
        šumu v celém obrazu, snite toto nastavení. Pro získání opravdu
        èistì vypadajícího obrazu pouijte vyšší hodnotu. Nenastavujte ho ale pøíliš vysoko,
        jinak obdríte plakátovitost (posterization).</p>
        <p>Bez ohledu na vaše nastavení <var>Stability</var> ,
        filtr vdy zachová urèité mnoství variací za úèelem
        zachování barevné hloubky pùvodního obrazu.</p>
        <p><var>DoSpatial</var><br>
        <i>Logickı; TRUE je vıchozí</i></p>
        <p>Toto nastavení rozhoduje zda chcete, aby filter pouil prostorové
        vyhlazení. Je to velmi jemnı vyhlazovaè, a je pouit vìtšinou na málo
        kontrastní, pohybové èásti obrazu. Filtr je trochu rychlejší,
        kdy je prostorové filtrování vypnuto.</p>
        <p><var>Spatial</var><br>
        <i>Celé èíslo od 0 do 400; 100 je vıchozí</i></p>
        <p>Toto urèuje jak silné prostorové vyhlazení bude pouito. Je to mìøeno v
        procentech, relativnì k mnoství èasového vyhlazení. Ale Peach
        upøednostòuje pouití èasového vyhlazení kde je to moné, take prostorové
        vyhlazení se spustí jen kdy èasové vyhlazení sele.</p>
        <p><var>Dot</var><br>
        <i>Logickı; FALSE je vıchozí</i></p>
        <p>Je to... malı zelenı bod!</p>
        <p>S touto moností se objeví malinkı zelenı bod, kdy je potvrzen odhad šumu
        v aktuálním snímku. Zobrazí poblí levého horního rohu obrazu
        — konkrétnì o 16 níe a
        16 doprava od levého horního rohu. Bod (dot) je ukazatelem, e
        filtr urèil hodnotu šumu. Obecnì se vypne, kdy
        je celı obraz v rychlém pohybu — Kdy je tolik pohybu,
        e filtr pøestává vìøit aktuálnímu odhadu. V takovém pøípadì
        filtr pracuje váením pøedchozích dobrıch hodnot.</p>
        <p>Pokud je obraz v neustálém pohybu, bude tak pracovat dokud
        filtr dokáe urèit úroveò šumu. Interference má také sklon
        prodluovat odhad šumu — èas odhadu závisí
        na druhu a mnoství interferencí.</p>
        <p><var>Readout</var><br>
        <i>Logickı; FALSE je vıchozí</i></p>
        <p>Aby pomohl rozhodnout jak moc vyhlazovat, tento filtr mìøí šum ve
        videu. Kdy zapnete <var>Readout</var>, toto
        mìøení se zobrazí ve vıstupu.</p>
        <p>Uvidíte dvì èísla. Prvním je mìøení støední úrovnì šumu.
        Druhım je míra nejnišího mnoství šumu vidìného kdekoli v obrazu.
        To nabízí myšlenku, o tom jak moc se šum ve videu mìní.
        Tyto odhady se budou mìnit podle prùbìhu videa.</p>
        <p>Èísla jsou mìøeny jako pøedpokládané absolutní zmìny v jednotlivém
        pixelu (jak jeho barevnosti tak jasu) mezi dvìma sousedními snímky.</p>
        <p>To poskytuje objektivní mìøení šumu. To je také zpùsob jak
        zjistit hodnoty pro <var>NoiseLevel</var> a monost
        <var>Baseline</var>, popsané níe.</p>
        <p><var>NoiseLevel</var> a <var> Baseline</var><br>
        <i>Dvì nastavení — kadé je desetinné èíslo od 0.0 do
        100.0; ve vıchozím stavu nepouité</i></p>
        <p>Místo odhadování úrovnì šumu mùete øíci filtru Peach pøesnì,
        kolik šumu je v obrazu.</p>
        <p>Aby jste to tak provedli, zmìòte hodnoty jak pro <var>NoiseLevel</var>
        tak pro <var>Baseline</var>. Aby jste dostali tyto hodnoty, pouijte monost
        <var>Readout</var>, popsanou vıše. Všimnìte si, e
        <var> Baseline</var> by nikdy nemìl bıt vìtší ne
        <var>NoiseLevel</var>.</p>
        <p>Proè by jste chtìli zadávat tato èísla? Protoe Peach bere èas
        kdy zjišuje mnoství šumu. A v øídkıch pøípadech
        se mùe ošklivì mılit. (To je obvykle zpùsobeno scénami s mraky kouøe a
        prachu, co mùe Pach chybnì oznaèit za šum.) Zadáním
        hodnot šumu, nebude odhad nikdy kolísat. Pøeskoèení
        odhadu šumu také urychlí zpracování.</p>
        <p>Na druhou stranu, nìkterá videa opravdu mají rùzné mnoství
        šumu. V takovém pøípadì vám bude mnohem lépe s obvyklou detekcí šumu filtru Peach.</p>
        <p><var>ShowMotion</var><br>
        <i>Logickı; FALSE je vıchozí</i></p>
        <p>Toto je jiná obskurní diagnostika. Kdy je to zapnuto,
        filtr bude ukazovat svùj odhad zda se objevil pohyb. Bílé oblasti
        jsou definitivnì pohyblivé, èerné oblasti jsou definitivnì statické. Šedé
        oblasti jsou šedé oblasti.</p>
        <p><var>Debug</var><br>
        <i>Logickı; FALSE je vıchozí</i></p>
        <p>Tato monost má vıznam jen pro stout of heart. Pro vysvìtlení
        jeho vıstupu se podívejte na komentáøe dole <a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/deinterlace/DScaler/Plugins/FLT_AdaptiveNoise/"><cite>FLT_AdaptiveNoise.c
        </cite>
        </a>.</p>
        <h2>O filtru Peach</h2>
        <h3>Kolik redukce šumu bych mìl pouít?</h3>
        <p>A rozhodnou vaše oèi. Já rád udruji nastavení celkem
        nízko — rozmazané tváøe vypadají hùøe ne malé poruchy.</p>
        <p>Pøekvapivì mùe malé mnoství variací barev vylepšit obraz.
        Pøepnutím zpìt a vpøed mezi barvami je obraz
        schopen dát dojem barvy nìkde mezi. Šum mùe také
        pøekrıt umìlé struktury v obrazu a tím vám usnadòuje
        ignorovat chyby.</p>
        <p>S tímto na mysli, se Peach snaí ponechat malé mnoství
        barevnıch variací. Ve vısledku vám nikdy nedá plnì stabilní obraz.
        To je pravdìpodobnì špatné pro kompresi, ale zlepší to
        kvalitu obrazu.</p>
        <h3>Vidím hodnì rozmazání v døívìjších èástech
        mého konstantnì pohybujícího se (nebo velmi tmavého) videa. Co bych mìl udìlat pro zlepšení
        vısledkù?</h3>
        <p>Pokud vidíte hodnì rozmazání, zkuste pouít monost <var>Dot</var> .
        Pokud se ukáe zelenı bod, pak je problém takovı, e
        Peach nebyl schopen zjistit kolik tam bylo šumu.</p>
        <p>Existuje nìkolik zpùsobù jak to vyøešit. Nejlepším je zapnout monost <var>Readout</var>
        a sledovat pozdìjší èást videa, kde je obraz statickı.
        Poznamenejte si hodnoty <var>NoiseLevel</var> a <var>Baseline</var>
        ze statické èásti. Pak je zadejte do vašeho pøíkazu, a celá
        sekvence by mìla vypadat dobøe.</p>
        <p>Pokud vaše video nemá ádné statické èásti, tak by jste mìli prostì pøeskoèit
        tento filtr. Èasovı vyhlazovaè neudìlá moc dobrého
        pro èistì vysoce pohyblivı materiál.</p>
        <p>Další zpùsob jak vyøešit tento problém je vloit nìjaké statické video (ze
        stejného klipu) na zaèátek sekvence. To umoní filtru
        Peach odhadnout šum pøed tím ne se ukáe rychlı materiál.</p>
        <h3>Obraz vypadá trochu mìkkı. Je nìco, co s tím mohu udìlat?</h3>
        <p>Zkuste sníit nastavení <var>Stability</var>.</p>
        <h2>Šum obecnì</h2>
        <h3>Jakı je nejlepší zpùsob odstraòování šumu?</h3>
        <p>Pøesvìdète se, e máte dobrı signál. Šum mùe pocházet ze shlukù kabelù,
        špatnıch spojení, slabého vıkonu a uzemìní, špatnì navrené video
        karty, elektrickıch pomùcek (cokoli od vypínaèù svìtla a po rùzné
        poèítaèové komponenty) nebo ze špatného zdroje videa. Tyto problémy jsou
        mimo rámec tohoto souboru nápovìdy. Navrhl bych podívat se na <a href="http://www.avsforum.com/"><cite>AV
        Science Forum</cite> </a>’s Home Theater Computers FAQ and board, kde
        jsou tyto námìty podrobnì diskutovány.</p>
        <h3><font face="Arial">Mìl bych pouít šumovı filtr?</font></h3>
        <p>To záleí na tom co sledujete. Sport a pøíroda zobrazující
        obecnì — skuteènì cokoli s pohyblivou nízkokontrastní
        texturou — nebıvají dobøe zpracovány èasovımi vyhlazovaèi. To je
        proto, e textura vypadá hodnì jako šum.</p>
        <p>Peach pracuje dobøe s obtínım materiálem a vypíná se tam kde je
        detekován pohyb. To zpùsobuje pøekvapivì málo problémù s polovımi sporty
        dokud šum pozadí není pøíliš špatnı. Ale to není perfektní
        — Automobilové závody jsou obzvláštì rozmazané. Kdy to nastane,
        je nejlepší pøeskoèit jakékoli èasové vyhlazovaèe.</p>
        <p>Jinak je obecnì dobré pouít šumovı filtr.</p>
        <h3>Kolik šumovıch filtrù bych mìl pouít?</h3>
        <p>Buïte velmi opatrní pøi pouívání více ne jednoho. Spuštìní více èasovıch
        šumovıch filtrù mùe zpùsobit, e další filtry budou pøíliš dùvìøovat
        svému odhadu šumu/pohybu. To obvykle vede k plakátovitosti (posterization),
        skvrnitosti (speckling), a pruhovitosti (banding).</p>
        <p>Spuštìní prostorového filtru po Peach Smoother mùe pracovat
        celkem dobøe, protoe jeho prostorové vyhlazení je celkem jemné — prostì
        se jen pøesvìdète, e nespustíte prostorovı filtr jako první (pøed Peach).</p>
        <h3>Kam bych mìl ve svém skriptu vloit šumovı filtr?</h3>
        <p>Obecnì je nejlepší filtrovat šum jak nejdøíve je to jen moné. To je
        zvláš pravdou pro Peach, protoe jeho odhad šumu  mùe bıt zkreslen
        nìkterımi filtry. Napøíklad, Pokud dáváte titulky do vašeho videa, Peach
        mùe detekovat chybìjící šum v titulcích.</p>
        <p>U prokládaného materiálu je velmi dobrı nápad umístit filtr
        pøed odstraòování prokládání. To je proto, e dobrá redukce šumu mùe vıznamnì
        zlepšit pøesnost odstraòování prokládání.
        <p>Pro inverzní telecine je situaci horší posoudit. Ale podle empirického pravidla
        je pøece jen lepší spustit redukci šumu první.
        <p>Vıjimkou k tomuto pravidlu je høebenové (comb) filtrování. Jakékoli høebenové filtry by mìli
        bìet pøed sniováním šumu, protoe šumovı filtr jinak bude
        interpretovat barevné poruchy jako pohyb.</p>
        <h3>Mohou jiné triky pomoci sníit šum?</h3>
        <p>Pokud pouíváte Bt8x8 kartu, mùete vypnout Odd a Even Luma
        Peaking. Zapnutí horizontálního filtru karty sníí šum, ale
        také ztratí nìkteré detaily.</p>
        <h2>Zmìny filtru</h2>
<ul>
  <li>Version 0.9a — Initial release</li>
  <li>Version 0.9b — Allowed parameters to be set; Different defaults;
        Corrected to deal with Y = 16 black; Additional orange smoke</li>
  <li>Version 0.9c — Added parameter checking</li>
  <li>Version 0.9d — Corrected to allow spatial smoothing of more than
        100%</li>
  <li>Version 0.9e — Filter now turns off when jumping between frames</li>
  <li>Version 0.9f — Filter now handles interlaced material correctly;
        The smoothing option has been rescaled to something closer to a real
        percentage; Different defaults; Yet more orange smoke</li>
  <li>Version 0.9g — Enabled spatial (but not temporal) smoothing when
        jumping between frames; Turning off spatial smoothing now improves
        speed; enabled prefetching for a speedup; improved parameter handling</li>
  <li>Version 0.9h — Provided a (legible) onscreen readout of the amount
        of noise. Allowed noise values to be supplied by the user. Allowed
        spatial smoothing in the first frame.</li>
  <li>Version 1.0a — Improved determination of amount of spatial
        smoothing to use. Improved horizontal correlation code. Improved
        accuracy of noise estimate readout. Made temporal color combination
        closer to the theoretical goal. (Side effect: you might want to drop
        your NoiseReduction by about ten points.) Increased role of spatial
        correlation in motion estimates. Changed the name of the Estimates
        option to Readout.</li>
  <li>Version 1.0b — Provided a display of the internal motion estimate
        with the ShowMotion option. Allowed negative Stability settings.</li>
  <li>Version 1.0c — Moved the readout a little further from the edge of
        the screen.</li>
</ul>
<p><kbd>$English Date: 2004/08/17 20:31:18 $</kbd></p>
<p><kbd>Èeskı pøeklad:10.5.2009</kbd></p>
</body>
</html>
