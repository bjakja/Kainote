<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<TITLE>DeFreq plugin for AviSynth</TITLE>
<link rel="stylesheet" type="text/css" href="../../avisynth.css"></head>
<BODY>
<H1>DeFreq</H1>
<h2>Pøehled</h2>
<b>autor:</b> Fizick(Aleksandr Balachnin)
<br><b>verze:</b> 0.7
<br><b>stáhnout:</b> <a href="http://avisynth.org.ru/">http://avisynth.org.ru/</a>,
<a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a> <br>
<b>kategorie:</b>  Pluginy pro televizní poøady<br>
<b>požadavky:</b> YV12 nebo YUY2 Barevné prostøedí<br>
<b>licence:</b>  GPL
<hr>
<H3>Odstraòovaè interference frekvencí</H3>
<P>DeFreq je filtr, který mùže odstranit nìkteré interferující frekvence z video
snímkù.</P>
<P>Mùže být použit pro odstranìní pravidelných vertikálních, horizontálních nebo šikmých
pruhù z nìkterých analogových TV nahrávek bez jakéhokoli snížení kvality obrazu. </P>
<H2>Ukázka obrázku s prací filtru</H2>
<P>Èásti obrázku od shora dolù:</P>
<P>1 - TV zdroj s interferencí (oøíznuto); <BR>2 - Defreq v.0.6 s
režimy <VAR>show</VAR> a <VAR>info</VAR> (2 vyhledávací okna);<BR>3 - oèištìný
výstup;<BR>4 - Rozdíl vstupu-výstupu.</P>
<P><IMG src="../../english/pictures/externalfilters/defreq6.jpg" border=0></P>
<H2>Technické info</H2>
<P>DeFreq používá rychlou metodu Fourierovy transformace (Fast Fourier Transform - FFT)
pro výbìr a odstraòování frekvence.</P>
<P>Je to prostorový (spatial) filtr, a pracuje následovnì:</P>
<OL>
  <LI>získá frekvenèní spektrum dopøednou (forward) FFT transformací obrazu snímku;
  <LI>hledá nìkterým definovaným spektrálním oknem (okny) lokální špièky (maximum,
  extrém, nejintenzivnìjší frekvence);
  <LI>odstraní ze spektra frekvenci na této ostré špièce a nìkteré podobné podle
  amplitudy sousedù ve vyhledávacím oknì;
  <LI>volitelnì zeslabí nejvyšší frekvence low pass Butterworth filtrem (pro
  rozmazání, vyhlazení);
  <LI>získá výstupní snímek inverzní FFT transformací oèištìného spektra. </LI></OL>
<H2>Parametry funkce</H2>
<P><CODE>Defreq</CODE>(<VAR>clip, float "fx", float "fy", float "dx", float
"dy", float "sharp", float "fx2", float "fy2", float "dx2", float "dy2", float
"sharp2", float "fx3", float "fy3", float "dx3", float "dy3", float "sharp3",
float "fx4", float "fy4", float "dx4", float "dy4", float "sharp4", float
"cutx", float "cuty", int "plane", int "show", bool "info", bool
"measure"</VAR>)</P>
<P>první parametr - vstupní klip<BR><VAR>fx</VAR> -
x-komponenta centrální frekvence okna pro lokální vyhledávání špièek (desetinné procento od 0.0 do 100.0, výchozí=
10.0)<BR><VAR>fy</VAR> - y-komponenta centrální frekvence okna pro lokální vyhledávání špièek
desetinné procento od -100.0 do 100.0, výchozí= -10.0)<BR><VAR>dx</VAR> -
polovina šíøky vyhledávacího okna, (desetinné procento, výchozí =1.5). <BR><VAR>dy</VAR> -
polovina výšky vyhledávacího okna, (desetinné procento, výchozí =2.0).
<BR><VAR>sharp</VAR> - prahová hodnota špièky ve vztahu k pozadí (ve vyhledávacím
oknì) pro oèištìní (desetinný, výchozí=50.0)<BR><VAR>fx2</VAR> - x-komponenta centrální
frekvence druhého okna pro lokální vyhledávání špièek (desetinné procento od 0.0 do 100.0, výchozí=
0 - vypnuto)<BR><VAR>fy2</VAR> - y-komponenta centrální frekvence druhého okna pro lokální
vyhledávání špièek desetinné procento od -100.0 do 100.0, výchozí=0
- vypnuto)<BR><VAR>dx2</VAR> - polovina výšky druhého vyhledávacího okna,
(desetinné procento, výchozí =1.5). <BR><VAR>dy2</VAR> - polovina šíøky druhého vyhledávacího okna,
(desetinné procento, výchozí =2.0). <BR><VAR>sharp2</VAR> - prahová hodnota špièky ve vztahu
k pozadí (ve druhém vyhledávacím oknì) pro oèištìní (desetinný, výchozí=50.0)<BR>
<VAR>fx3</VAR> - x-komponenta centrální
frekvence tøetího okna pro lokální vyhledávání špièek (desetinné procento od 0.0 do 100.0,
výchozí= 0 - vypnuto)<BR><VAR>fy3</VAR> - y-komponenta centrální frekvence tøetího okna pro lokální
vyhledávání špièek desetinné procento od -100.0 do 100.0, výchozí=0
- vypnuto)<BR><VAR>dx3</VAR> - polovina výšky tøetího vyhledávacího okna,
(desetinné procento, výchozí =1.5). <BR><VAR>dy3</VAR> - polovina šíøky tøetího vyhledávacího okna,
(desetinné procento, výchozí =2.0). <BR><VAR>sharp3</VAR> - prahová hodnota špièky ve vztahu
k pozadí (ve tøetím vyhledávacím oknì) pro oèištìní (desetinný, výchozí=50.0)<BR><VAR>fx4</VAR> - x-komponenta centrální
frekvence ètvrtého okna pro lokální vyhledávání špièek (desetinné procento od 0.0 do 100.0,
výchozí= 0 - vypnuto)<BR><VAR>fy4 </VAR>- y-komponenta centrální frekvence ètvrtého okna pro lokální
vyhledávání špièek desetinné procento od -100.0 do 100.0, výchozí=0
- vypnuto)<BR><VAR>dx4</VAR> - polovina výšky ètvrtého vyhledávacího okna,
(desetinné procento, výchozí =1.5). <BR><VAR>dy4</VAR> - polovina šíøky ètvrtého vyhledávacího okna,
(desetinné procento, výchozí =2.0). <BR><VAR>sharp4</VAR> - prahová hodnota špièky ve vztahu
k pozadí (ve ètvrtém vyhledávacím oknì) pro oèištìní (desetinný, výchozí=50.0)<BR>
<VAR>cutx</VAR> - x-komponenta mezní frekvence pro filtraci vysokých frekvencí
(desetinné procento od 0.0 do 300.0, výchozí = 0,
vypnuto)<BR><VAR>cuty</VAR> - y-komponenta mezní frekvence pro filtraci vysokých frekvencí
(desetinné procento od 0.0 do 300.0, výchozí = 0,
vypnuto)<BR><VAR>plane</VAR> -
barevná plocha pro èištìní, 0-Y, 1-U, 2-V (výchozí = 0)<BR><VAR>show</VAR> - zobrazí
frekvenèní spektrum a vyhledávacích oken (výchozí = 0)<BR>0 - normální
zpracování;<BR>1 - zobrazí spektrum aktuálního snímku;<BR>2 - zobrazí èasový (temporal) prùmìr
spektra;<BR><VAR>info</VAR> - ukazuje info o nalezených špièkách (výchozí =
false)<BR><VAR>measure</VAR> - vybere nejrychlejší FFT metodu mìøením rychlosti
(delší inicializaèní èas) místo jednoduchého odhadu (výchozí=true) <BR></P>
<H2>Zvláštnosti a omezení</H2>
<OL>
  <LI>Pracuje jen v YV12 nebo YUY2 barevných formátech.
  <LI>Pøímo pracuje s progresivními klipy. Pro prokládané zdroje, budete muset pravdìpodobnì
  použít SeparateFields atd.
  <LI>Testováno s Avisynthem v2.5.5-2.5.6.
  <LI>Defreq používá rychlou externí FFTW knihovnu verze 3 (<A
  href="http://www.fftw.org/">http://www.fftw.org/</A>), jako Windows binární DLL (kompilovanou gcc pod MinGW Alessiem Massarem),
která podporuje více vláken a má AMD K7 (3dNow!) podporu navíc k SSE/SSE2.Mùžete ji stáhnout z
<A href="ftp://ftp.fftw.org/pub/fftw/fftw3win32mingw.zip">ftp://ftp.fftw.org/pub/fftw/fftw3win32mingw.zip</A>.
  <SPAN style="COLOR: rgb(255,0,0)">MUSÍTE</SPAN> vložit soubor FFTW3.DLL z tohoto balíku (ne fft3dfilter.dll)
  do nìjaké složky v systémem prohlížené cestì (napøíklad, C:\WINNT\SYSTEM32). Defreq bez ní <SPAN style="COLOR: rgb(255,0,0)">NEBUDE</SPAN>
  pracovat!
  <LI>Není pøíliš rychlý, bez assembler optimalizací.
  <LI>Od v.0.4, je horizontální frekvence relativní ke spektrální šíøce obrazu
  (asi polovina šíøky plochy), od 0 do 100 %, a vertikální frekvence je
  relativní k polovinì výšky spektrálního obrazu (výška plochy), od -100 do 100%.
  <LI>Od verze 0.4, jsou hodnoty frekvencí <VAR>fx,fy</VAR>, atd. nezávislé na
  oøíznutí, ale musí být zvìtšovány (zmenšovány) po resize! </LI></OL>
<H2>Jednoduchý pøíklad skriptu</H2>
<PRE>Avisource("input.avi")
loadplugin("defreq.dll")
DeFreq(fx=30,fy=-40)</PRE>
<P>Pozor! Je to jen pøíklad syntaxe výzvy. Narozdíl od vìtšiny jiných filtrù,
nejsou ŽÁDNÉ dobré hodnoty parametrù DeFreq pro obecné použití! <BR>Nic nevyèistí
(ale zpomalí zpracování), pokud jeho nastavení pøesnì neodpovídá
vašemu obrazu. </P>
<H2>Jak ho použít</H2>
<P>Musíte doèasnì pøidat parametry <VAR>show</VAR> a <VAR>info</VAR> ,
vizuálnì analyzovat plochu frekvenèního spektra, a nastavit parametry
<VAR>fx,fy</VAR> pro umístìní obdélníèku vyhledávacího okna na lokální špièku spektra
(jasný bod nebo køíž), která odpovídá interferenèní frekvenci.</P>
<P>Nejdøíve si prohlédnìte generovaný vzorek frekvenèních pruhù v pravém horním rohu,
a zkuste je vytvoøit podobné vaší interferenèní šablonì obrazu (pravá spodní oblast).
Sklon vzorku pruhù závisí na pomìru <VAR>fy/fx</VAR> a krok
mezi pruhy závisí na absolutních hodnotách <VAR> fx,fy</VAR>
(nápovìda - mùžete použít nìkterý AviSynth skriptový parametr pro zachování pomìru <VAR>fy/fx</VAR>). </P>
<P>Pak si prohlédnìte plochu spektra, a jemnì nalaïte pozici vyhledávacího okna.<BR>
Malé <VAR>fx</VAR>je blízko levému okraji spektrálního obrazu, a
velké <VAR>fx</VAR> (až do 100) je blízko pravému okraji.<BR>Od v0.6, jsou
velké záporné hodnoty <VAR>fy</VAR> ve spodu spektrálního obrazu, velké kladné
<VAR>fy</VAR> (až do 100) je navrchu spektrálního obrazu, malé
<VAR>fy</VAR> je ve støedu výšky.</P>
<P>Nastavte <VAR>fx</VAR>=0 pro pøísnì horizontální frekvenèní interferenèní pruhy,
nebo nastavte <VAR>fy</VAR>=0 pro pøísnì vertikální pruhy.</P>
<P>Režim <VAR>show</VAR>=2 udìlá špièky frekvenèního spektra viditelnìjší èasovým
zprùmìrováním spektrální hustoty. Prostì pøehrajte svùj video klip
(pøednostnì dynamické scény), a vylaïte <VAR>fx,fy</VAR>. </P>
<P>Mùžete vyladit jiné parametry pro nastavení ostrosti prahohé hodnoty, barevné plochy, pøidejte
další vyhledávací okna, pøidejte low pass filtr.<BR>Nápovìda - slovo "sharp" se stává
UPPERCASE (v <VAR>info</VAR> režimu), když je detekována špièka s hodnotou vyšší než prahovou.</P>
<H2>Doplòkové info</H2>
<P>Diskuse o filtru je na<A
href="http://forum.doom9.org/showthread.php?s=&amp;threadid=82978">http://forum.doom9.org/showthread.php?s=&amp;threadid=82978</A></P>
<P>Existují také podobné nové filtry FanFilter a FQuiver (by vcmohan).</P>
<H2>Licence</H2>
<P>Tento program je svobodný software; mùžete ho šíøit a/nebo upravovat<BR>
za podmínek GNU General Public License version 2 jak je publikována od
<BR>Free Software Foundation.<BR><BR>Tento program je šíøen v nadìji, že bude užiteèný,<BR>
ale BEZ JAKÉKOLI ZÁRUKY; dokonce bez pøedpokládané záruky<br>
OBCHODOVATELNOSTI  nebo POUŽITÍ PRO KONKRÉTNÍ ÚÈELY. Viz<br>
GNU General Public License pro více podrobností.<br><BR>Spolu s tímto programem by jste mìli obdržet kopii GNU General<br>
Public License; pokud ne, napište do Free Software Foundation.<br>
Inc., 675 Mass Ave, Cambridge, MA 02139, USA. </P>
Dokumentace je šíøena pod <A
href="http://creativecommons.org/licenses/by-sa/3.0/">CreativeCommons BY-SA 3.0
license.</A><BR>
<P>Zvažte prosím malou dotaci.</P>
<H2>Zmìny verzí:</H2>
<UL>
  <LI>Version 0.1, 22 September 2004 - not public alpha. Thanks to <SPAN
  style="FONT-WEIGHT: bold">Mil_Alex</SPAN> for preliminary discussion.
  <LI>Version 0.2, 26 September 2004 - add second window, set other planes to
  128 (first public beta).
  <LI>Version 0.3, 28 September 2004 - change cleaning method to adaptive in
  window, add third and fourth search windows, change default sharp=50.0 (was
  100.0 really) (not public)
  <LI>Version 0.4, 30 September 2004 - change <VAR>fx,fy,dx,dy,cutx,cuty</VAR>
  parameters to (float) percent of FFT size
  <LI>Version 0.4.1, 01 October 2004 - fixed bug with init
  <LI>Version 0.5, 02 October 2004 - add show sample frequency stripes, add
  Measure mode, some bugs fixed (still beta). Thanks to <SPAN
  style="FONT-WEIGHT: bold">Mug Funky</SPAN> and <SPAN
  style="FONT-WEIGHT: bold">JuanC</SPAN> for bugs report and discussion<BR>
  <LI>Version 0.5.0.1, 06 October 2004 - add Russian doc
  <LI>Version 0.5.1, 07 October 2004 - more fast processing of frames which are
  not needed in cleaning, source released under GPL.
  <LI>Version 0.5.2, 7 November 2004 - fixed strange bug for separated fields.
  Thanks to <SPAN style="FONT-WEIGHT: bold">johnmeyer</SPAN> for report.
  <LI>Version 0.5.3, 7 November 2004 - finally (?) fixed bug for separated
  fields. Thanks to <SPAN style="FONT-WEIGHT: bold">johnmeyer</SPAN> for report.

  <LI>Version 0.5.4, 3 December 2004 - Fixed bug for second peak for YUY2.
  Thanks to <SPAN style="FONT-WEIGHT: bold">oledoe</SPAN> for report. Manual
  corrected. Thanks to <SPAN style="FONT-WEIGHT: bold">Palmnut</SPAN> for
  report.
  <LI>Version 0.6, August 2, 2005 - added temporal average
  mode&nbsp;<VAR>show</VAR>=2&nbsp; (thanks to <SPAN
  style="FONT-WEIGHT: bold">lumier</SPAN> for idea), changed <VAR>show</VAR>
  parameter to integer type; reorganized view of the spectrum window; cleaned a
  code.<BR>
  <LI>Version 0.7, April 28, 2006 - changed cleaning method: more frequencies
  are decreased near interference peak. <BR>Chanded static linking of FFTW3.DLL
  library to dynamic loading. </LI></UL>

<H3><A href="http://avisynth.org.ru/defreq/defreq07.zip">Stáhnout DeFreq verze
0.7</A></H3>
<p><kbd>Èeský pøeklad:17.7.2009</kbd></p>
</BODY></HTML>
