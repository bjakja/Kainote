<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<title>VagueDenoiser</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
</head>
<body>
<h1>VagueDenoiser</h1>
<h2>Pøehled</h2>
<b>autor:</b> Lefungus, Kurosu, Fizick<br>
<b>verze:</b> 0.35.1<br>
<b>stáhnout:</b> <a href="http://avisynth.org.ru">http://avisynth.org.ru</a>,
<a href="http://avisynth.org/warpenterprises/">http://avisynth.org/warpenterprises/</a><b><br>
kategorie:</b> Prostorové vyhlazovaèe<br>
<b>poadavky:</b>&nbsp;
<ul>
  <li>YV12 &amp; YUY2 &amp; RGB barevné prostøedí</li>
</ul>
<p><b>licence:</b> GPL</p>

<h2>Úvod</h2>
<p>Toto vlnovı (Wavelet) odšumovaè.<br>
V zásadì pøevádí kadı snímek ze vstupního videa do
vlnové oblasti, pouitím rùznıch vlnovıch (wavelet) filtrù. Pak aplikuje nìjaké
filtrování k získanım koeficientùm. Potom provede inverzi vlnového
pøevodu. Kvùli vlnovım vlastnostem, by mìl dávat pìknı hladkı
vısledek, a sníit šum, bez rozmazání rysù obrazu.
Tento vlnovı pøevod mùe bıt udìlán na kadé ploše barevného prostøedí.
Tento filtr pouívá vlny (wavelets) z Brislawnova tutorialu.</p>

<h2>Syntaxe filtru VagueDenoiser</h2>
<p><code>VagueDenoiser</code> (<var>clip, int "threshold", int "method", int "nsteps", float "chromaT", bool "debug",
bool "interlaced", int "wavelet", bool "Wiener", float "wratio", integer "percent", clip "auxclip"</var>)</p>

<h4>Parametry:</h4>

<p><var>threshold</var>: desetinnı (float) (vıchozí=0)<br>
&nbsp;&nbsp;&nbsp; Síla filtrování. Èím vyšší, tím více bude klip filtrovanı.
Pøi tvrdém nastavení se mùe pouít vyšší prahová hodnota ne pøi mìkkém nastavení
dokud klip nevypadá pøefiltrovanı.<br>
&nbsp;&nbsp;&nbsp; Pøi nastavení &lt; 0 bude vypnuto odstraòování šumu na jasové sloce&nbsp;<br>
&nbsp;&nbsp;&nbsp; Pokud je nastaveno = 0, tak je prahová hodnota odhadnuta automaticky (adaptivnì)</p>

<p><var>method</var>: -1 a 4 (vıchozí=3)<br>
&nbsp;&nbsp;&nbsp; Filtraèní metoda, kterou filtr pouije.<br>
&nbsp;&nbsp;&nbsp; -1 : Bez stanovení prahovıch hodnot (ladící úèely)<br>
&nbsp;&nbsp;&nbsp; 0 : Tvrdé stanovení prahovıch hodnot. Všechny hodnoty pod prahovou hodnotou budou vynulovány.<br>
&nbsp;&nbsp;&nbsp; 1 : Mìkké stanovení prahovıch hodnot. Všechny hodnoty pod prahovou hodnotou budou vynulovány. Všechny hodnoty nad, budou sníeny o prahovou hodnotu.<br>
&nbsp;&nbsp;&nbsp; 2 : Adaptivní stanovení prahovıch hodnot (metoda NormalSrink). Násobí vstupní prahovou hodnotu podle lokálních vlnovıch dat (lokální = úrovnì podpásma vlnové úrovnì). <br>
&nbsp;&nbsp;&nbsp; 3 : Qianovo (garrotovo) stanovení prahovıch hodnot.  Násobí nebo nuluje koeficienty - støední mezi (více) mìkkım a (ménì) tvrdım stanovením prahovıch hodnot.<br>
&nbsp;&nbsp;&nbsp; 4 : Jednotnì hladká smršující funkce.
</p>

<p><var>nsteps</var>: celoèíselnı (vıchozí=4)<br>
&nbsp;&nbsp;&nbsp; Poèet krokù v kolika vlny rozloí obraz. Vysoké hodnoty mohou bıt pomalejší, ale vısledky budou lepší.<br>
&nbsp;&nbsp;&nbsp; Navrhované hodnoty jsou 3-6.<br>
&nbsp;&nbsp;&nbsp; Obraz nelze rozkládat za urèitou mez (typicky 8 pro snímek 640x480 - protoe 2^9 = 512 &gt; 480)</p>
<p><var>chromaT</var>: desetinnı (float) (vıchozí=-1)<br>
&nbsp;&nbsp;&nbsp; Nastavuje prahovou hodnotu filtrování barevnosti (chroma). Je to pomalejší, ale dává lepší vısledky.<br>
&nbsp;&nbsp;&nbsp; Pokud je nastaven &lt; 0, tak bude odšumìní barevnosti vypnuto (vıchozí reim)<br>
&nbsp;&nbsp;&nbsp; Pokud je nastaveno = 0, tak je prahová hodnota odhadnuta automaticky (adaptivnì)</p>
<p><var>debug</var>: true nebo false<br>
&nbsp;&nbsp;&nbsp; Deaktivuje inverzní pøevod pro pøímé zobrazení (ale nenormalizuje nyní koeficienty).<br>
&nbsp;&nbsp;&nbsp; Také zapíná vıstup pro utilitu Debugview</p>
<p><var>interlaced</var>: true nebo false (vıchozí=false)<br>
&nbsp;&nbsp;&nbsp; Snaí se zpracovat pole klipu jednotlivì.</p>
<p><var>wavelet</var>: celoèíselnı 1, 2 a nebo 3 (vıchozí=1)<br>
&nbsp;&nbsp;&nbsp; Vybírá typ vln (wavelet):<br>
&nbsp;&nbsp;&nbsp; 1 - Cohen-Daubechies-Feauveau 9/7 - populární, pravdìpodobnì nejlepší<br>
&nbsp;&nbsp;&nbsp; 2 - Brislawn 10/10 (ostrı, pouíval se jako jedinı ve všech pøedchozích verzích od 0.23 do 0.29)<br>
&nbsp;&nbsp;&nbsp; 3 - Villasenor-Belzer-Liao 6/10&nbsp;</p>
<p><var>Wiener</var>: true nebo false (vıchozí=false)<br>
&nbsp;&nbsp;&nbsp; Aktivuje WienerChop dvouprùchodovı reim odšumìní pro silné odšumìní s vysokou prahovou hodnotou (pomalı).<br>
&nbsp;&nbsp;&nbsp; V prvním prùchodu se dìlá odhad šumu pøevodem s první vlnou (jiná ne vybraná vlna) s vybranımi nataveními,<br>
&nbsp;&nbsp;&nbsp; druhı prùchod je optimální Wienerovo odšumìní druhou (vybranou) vlnou.<br>
&nbsp;&nbsp;&nbsp; Druhá vlna 1 je pouita s první (odhadovací) vlnou 3,&nbsp;<br>
&nbsp;&nbsp;&nbsp; Druhá vlna 2 je pouita s první (odhadovací) vlnou 1,&nbsp;<br>
&nbsp;&nbsp;&nbsp; Druhá vlna 3 je pouita s první (odhadovací) vlnou 1.&nbsp;</p>
<p><var>wratio</var>: desetinnı (float) (vıchozí=0.5)<br>
&nbsp;&nbsp;&nbsp; Hodnota standardní odchylky šumu pro Wienerovo odšumìní jako relativní pomìr k hodnotì prahové hodnoty.</p>
<p><var>percent</var>: celoèíselnı od 0 do 100 (vıchozí=85)<br>
&nbsp;&nbsp;&nbsp; Èásteèné nebo plné odšumìní (omezené zmenšení koeficientù).</p>
<p><var>auxclip</var>: pomocnı klip pro první prùchod Wienerova reimu (vıchozí=není, zdroj)<br>
&nbsp;&nbsp;&nbsp; Pøedfiltrovanı zdrojovı klip, nejlépe s
èasovım nebo prostorovì-èasovım filtrem (jako DeGrainMedian) pro nejlepší
odšumìní a potlaèení artefaktù.<br>
</p>

<h2>Pøíklady pouití filtru VagueDenoiser</h2>

<p>(všechny øádky avisynth skriptù zde jsou jen pøíklady)</p>
<h3>Nìkterá oblíbená (kdysi) nastavení Lefunguse</h3>
<p>Pro mírné filtrování obyèejného videa. (støední-&gt;threshold=1-1.5; silné-&gt;threshold=2-3)</p>
<pre>VagueDenoiser(threshold=0.8, method=1, nsteps=6, chromaT=0.8)</pre>
<p>Pro mírné filtrování animovaného videa. (støední-&gt;threshold=2; silné-&gt;threshold=4)</p>
<pre>VagueDenoiser(threshold=1.5, method=1, nsteps=6, chromaT=2.0)</pre>
<p>Quianovo stanovení prahovıch hodnot je upøednostnìnou metodou, protoe je podobnìjší optimálnímu (Bayesian).</p>

<h3>Nìkterá silná (ale pomalá) nastavení od Fizick</h3>
<p>Pro silné filtrování (s vysokou prahovou hodnotou) zašumìlého prokládaného analogového videa.
 V tomto pøípadì je charakteristické objevování artefaktù "kapek" ,
obzvláštì pro tvrdé stanovení prahovıch hodnot (Quianùv reim je optimální). To je
dùsledek pouití rychlého decimovaného vlnového pøevodu, a také pulsování "horkıch"
pixelù. Pouijte optimální Wienerùv filtr. Nejdøíve proveïte odhad vıkonu signálu
a šumu v jednom vlnovém základu. Pak
pouijte jinı vlnovı základ (témìø nekorelovanı) pro filtrování, t.j.
slabé sníení hodnoty (pouitím pøedchozího odhadu). Dodateènì snite vliv
"horkıch pixelù" mediánovım
èasovım pøedfiltrováním (undot, degrainmedian),
a pouijte vısledek jako pomocnı klip pro odhad šumu.
Tento pomocnı klip lze silnì filtrovat protoe ho
nepouíváte jako vstup pro Vaguedenoiser.
(Ostatnì, teï nezískáte pøísnì prostorové vyhlazení).
Viz pøíklad (pomalı):</p>

<pre>LoadPlugin(&quot;vaguedenoiser.dll&quot;)
LoadPlugin(&quot;degrainmedian.dll&quot;)
avisource(&quot;input.avi&quot;)
aux=DeGrainMedian(mode=0, limity=7, interlaced=true)
VagueDenoiser(threshold=7, auxclip=aux, interlaced=true, wiener=true)</pre>

<h2>Historie a staení</h2>
<ul>
  <li>v 0.12 First Release
    <ul>
      <li>Precision problems corrected, 0 for threshold is now lossless.</li>
    </ul>
  </li>
  <li>v 0.13
    <ul>
      <li>Hard thresholding method enabled.</li>
      <li>Cosmetic changes.</li>
      <li>Avisynth parameters changed.</li>
    </ul>
  </li>
  <li>v 0.2
    <ul>
      <li>Implemented many new wavelet filters, thanks to the wavelet transform coder construction kit.
        look at http://www.geoffdavis.net/ for more informations.</li>
      <li>Implemented nsteps parameter, that allow you to use n steps in the selected wavelet tranform.</li>
      <li>Some nsteps values could produce unvalid results, reducing this value generally solve the problem.</li>
      <li>Little optimizations from Shodan and Bidoche.</li>
    </ul>
  </li>
  <li>v 0.22
    <ul>
      <li>YUY2 colorspace support.</li>
      <li>Optionnal chroma filtering, (chroma=true/false).</li>
      <li>Cosmetic changes, code cleaned.</li>
      <li>Html documentation.</li>
    </ul>
  </li>
  <li>v 0.23
    <ul>
      <li>Code cleaned, filters class removed.</li>
      <li>Better parameters for compilation. Should really works on every cpu now.</li>
      <li>Removed all filters except Brislawn 10/10, so filter parameter has been removed.(it's like filter=7).</li>
      <li>A little speed increase (3-5fps on a 640x256 frame with nsteps=6).</li>
    </ul>
  </li>
  <li>v 0.24
    <ul>
      <li>Another speed increase, some critical loops unrolled (To infinity and beyond!)</li>
    </ul>
  </li>
  <li>v 0.241
    <ul>
      <li>height and width must be mod4, added errors messages if not</li>
      <li>Cleaned include thanks to Kurosu</li>
    </ul>
  </li>
  <li>v 0.242
    <ul>
      <li>Removed restrictions on width/height, fixed bugs</li>
      <li>Some improvements from Kurosu</li>
    </ul>
  </li>
  <li>v 0.243
    <ul>
      <li>Code cleaned</li>
    </ul>
  </li>
  <li>v 0.25
    <ul>
      <li>Little speed increase (due to some little profiles and vectorizations)</li>
      <li>added defaults</li>
      <li>added a visual.net compiled dll for compatibility purposes. This dll is slower</li>
    </ul>
  </li>
  <li>v 0.26 (Kurosu)
    <ul>
      <li>Merged (C++ frenzy) all assembly parts from Kurosu's version into one dll</li>
      <li>Hence, speed increase</li>
      <li>Undone previous vectorization optimizations</li>
      <li>All improvements are available for YV12 only</li>
    </ul>
  </li>
  <li>v 0.26.1 (Kurosu)
    <ul>
      <li>Merge from Sh0dan on copy</li>
      <li>Cleaner and safer management from Bidoche</li>
      <li>Fixed a crash that may have affected P4 users (Athlons with SSE support weren't affected as 3DNow! code, being the fatest, is always selected).</li>
      <li>Added debug output and NOOP threshold method (for debug purpose)</li>
    </ul>
  </li>
  <li>v 0.27.0 (Kurosu)
    <ul>
      <li>Continued integration and added framework for Haar wavelet (still not functionnal, deactivated)</li>
      <li>All optimizations proposed by Sh0dan, ARDA and Bidoche</li>
      <li>Some registers reuse (AMD-64 gonna rock) for some more speed (5%)</li>
      <li>Added Qian thresholding</li>
    </ul>
  </li>
  <li>v 0.27.1 (Kurosu)
    <ul>
      <li>Fixed YUY2 mode</li>
      <li>Added RGB24 and RGB32 mode</li>
      <li>The 3 above modes are unlikely to get any speed optimization</li>
    </ul>
  </li>
  <li>v 0.28.0 (Kurosu)
    <ul>
      <li>Fixed all modes to properly process what needs to be processed (small speedup)</li>
      <li>Unrolled float2byte conversion, little speed-up</li>
      <li>Added interlaced (see option with that name) support to YV12 colorspace</li>
      <li>Workspace compatible with ICL7. dll isn't compiled in that mode for legal reasons (I don't own ICL)</li>
      <li>Decteted a major slowdown for MOD64 width. Avoid them, as applying this filter before resizing might be faster in fact (particularly true for widths of 512)</li>
    </ul>
  </li>
  <li>v 0.28.1 (Kurosu)
    <ul>
      <li>MOD64 width slowdown is due to something needing a dreadfull rewrite, so no fix</li>
      <li>Implemented cleaner support of YUY2 and RGB24/32</li>
      <li>Interlaced mode now works in all mode (processing in interlaced mode is a little bit faster but you loose precision)</li>
    </ul>
  </li>
  <li>v 0.28.2 (Kurosu)
    <ul>
      <li>Ported to nasm the assembly parts&nbsp;</li>
    </ul>
  </li>
  <li>v 0.29 (Kurosu)
    <ul>
      <li>More nasm</li>
      <li>More bug fixes</li>
    </ul>
  </li>
  <li>v 0.30 (Fizick)
    <ul>
      <li>Added (restored) CDF 9/7 wavelet (C version only) and wavelet selection option</li>
      <li>Added WienerChop two-pass denoising mode using two different wavelet basises.</li>
      <li>Replaced boolean "chroma" parameter to float "chromaT" as threshold value for chroma planes</li>
      <li>Added automatic (adaptive) threshold estimation</li>
      <li>3DNow mode of hard thesholding temporary replaced by SSE or C versions.</li>
      <li>Fixed possible memory leakage bug for non YV12 modes</li>
    </ul>
  </li>
  <li>v 0.31 (Fizick)
    <ul>
      <li>Added noise ratio parameter for Wiener pass</li>
      <li>Fixed interlaced mode. Seems it now work.</li>
      <li>3DNow mode of Qian thesholding temporary replaced by SSE or C versions.</li>
    </ul>
  </li>
  <li>v 0.32 - July 09, 2004 (Released by Fizick, but part of work was done by Kurosu)
    <ul>
      <li>Added Villasenor-Belzer-Liao 6/10 wavelet (not optimized C version only)</li>
      <li>Changed estimation wavelets to more optimal pairs for WienerChop mode.</li>
      <li>3DNow optimized version of WienerChop and AutoThreshold - thanks to Kurosu.</li>
      <li>3DNow mode of hard and Qian thesholding re-enabled after some bugs were fixed by Kurosu and Fizick.</li>
      <li>Small speed increasing mainly due to copy reverse order</li>
      <li>But big slowdown for mod64 width (especially 512!) still exists.</li>
      <li>SSE float-byte conversion has bug for some width, temporary replaced to C version.</li>
      <li>Ported to NASM memcopy assembly function (no more non-NASM assembly).</li>
    </ul>
  </li>
  <li>v 0.32.1 - July 10, 2004 (Fizick)
    <ul>
      <li>Fixed bug in copy function, introduced in v.0.32</li>
      <li>Re-enabled SSE optimized float-byte and byte-float conversion after fixing some bugs</li>
    </ul>
  </li>
  <li>v 0.33 - July 11, 2004 (Fizick)
    <ul>
      <li>Fixed slowdown for mod64 width by padding (thanks to MfA)</li>
      <li>Add partial denoising mode (by blending with source)</li>
      <li>Fixed bug with AutoThreshold for 3DNow.</li>
      <li>AutoThreshold is now also dependent from "wratio" parameter.</li>
      <li>Added messages for Debugview utility.</li>
      <li>Change some parameters default values to more optimal (for me?):
      <var>thresh=0 (auto), method=3, nsteps=4, wavelet=1, percent=75.</var></li>
    </ul>
  </li>
  <li>v 0.33.1 - July 13, 2004 (Fizick)
    <ul>
      <li>Fixed bug with mod64 width for SSE (by pad increasing from 2 to 4)</li>
    </ul>
  </li>
  <li>v 0.33.2 - July 17, 2004 (Fizick)
    <ul>
      <li>Fixed bug with default values.</li>
    </ul>
  </li>
  <li>v 0.33.3 - July 21, 2004 (Fizick)
    <ul>
      <li>Fixed bug with YUY2 (introduced in v.0.32.1)</li>
    </ul>
  </li>
<li>V.0.33.4 - August 23, 2004 (Fizick)
<ul>
  <li>Fixed bug with mirrored padded pixels (thanks to Eugen65 for report).</li>
</ul>
</li>
<li>V.0.33.5 - September 28, 2004 (Fizick)
<ul>
  <li>Fixed bug with AutoThreshold for Interlaced Wiener mode (thanks to Viperzahn and LigH for report).</li>
</ul>
</li>
<li>V.0.33.6 - October 13, 2004 (Fizick)
<ul>
  <li>Nsteps parameter now is auto-limited to max admissible value if input too big or =0 (don't worry, Viperzahn :-) </li> <li>Some improving of exception handling (try-catch-throw).</li>
</ul>
</li>
<li>V.0.33.7 - October 17, 2004 (Fizick)
<ul>
  <li>Decreased max admissible value of nsteps to fix some internal bug (or feature)
(thanks to Viperzahn for insistent report :-)</li>
</ul>
</li>
<li>V.0.34 - November 24, 2004 (Fizick)
<ul>
  <li>Added auxiliary (some prefiltered) clip for first pass of Wiener mode.</li>
</ul>
</li>
<li>V.0.34.1 - December 19, 2004 (Fizick)
<ul>
  <li>Some fix for mem_set compatibility with old CPU (P2).</li> </ul>
</li>
<li>V.0.34.2 - March 11, 2005 (Fizick)
<ul>
  <li>Fixed small bug (blue dot) for chromaT&gt;=0 in YV12 for Athlon (Thanks to Pavico for report). </li>
  <li>Added pitch for internal buffers. </li>
</ul>
</li>
<li>V.0.34.2.0 - June 13, 2005 (Fizick)
<ul>
  <li>Updated documentation.</li>
</ul>
</li>
<li>V.0.34.3 - September 11, 2005 (Fizick)
<ul>
  <li>Fixed AutoThreshold algorithm.</li>
</ul>
</li>
<li>V.0.35 - September 17, 2005 (Fizick)
<ul>
  <li>Improving soft <var>method=1</var> - do not filter lowest level anymore, mean picture intensity is not changed now .</li>
  <li>Re-enabled <var>method=2</var> of multilevel subband adaptive thresholding, implemented as NormalShrink method;</li>
  <li>Added <var>method=4</var> uniformly smooth shrinking function;</li>
  <li>Replaced partial denoising blend mode by limited shrinking of small coefficients for all thresholding functions;</li>
  <li>Changed default <var>percent=85</var>;</li>
  <li>Implemented new SSE versions for <var>method=0,3,4</var> and C versions for rest (3DNow disabled with 4% speed decreasing);</li>
  <li>Added 3DNow optimized versions for transform of wavelet 1 and 3 (10% speed).</li>
</ul>
</li>
<li>V.0.35.1 - September 26, 2005 (Fizick)
<ul>
  <li>Added YUY2 and RGB format for auxclip</li>
</ul>
</li>
</ul>
<h2>Podìkování</h2>
<p>* Všem na Doom9.org za jejich rady.<br>
    * MarcFD za jeho mpegdec3 html dokumentaci. Tento html soubor je stejnı, ale s upravenım obsahem.<br>
    * Lefungusovi za jeho VagueDenoiser html dokumentaci. Tento html soubor je stejnı, ale s upravenım obsahem. :)<br>
    * Kurosu za jeho VagueDenoiser html dokumentaci. Tento html soubor je stejnı, ale s upravenım obsahem. :-) (ale nyní èásteènì pøeformátovanı)<br>
    * Geoffu Davisovi, autorovi konstrukèního nástroje kodéru vlnového (wavelet) pøevodu.<br>
    * Lefungusovi, tvùrci VagueDenoiser.<br>
    * Kurosu, reorganizce a optimalizace kódu.<br>
    * Fizick, nìjaká deorganizace a deoptimalizace kódu. :-)</p>
<h2>Distribuce kódu</h2>
<p>Toto je svobodnı software šíøenı za podmínek GNU-GPL v2&nbsp;.</p>
<h2>Kontakt</h2>
<p>Mùete napsat e-mail Lefungusovi: lefungus (at) altern (dot) org s vìtšinou návrhù, hlášením chyb, poadavkùm na funkce, a další.<br>
Lefungusova webová stránka: <a href="http://perso.wanadoo.fr/reservoir/avisynth.html"><cite>http://perso.wanadoo.fr/reservoir/avisynth.html</cite></a> <br>
Otázky optimalizace jsou pro Kurosu.<br>
Ještì by jste mìli vìdìt, e najdete Kurosu zde: <U>kurosu (at) inforezo (dot) org</U><br>
Fizick není za nic odpovìdnı, ale obvykle se snaí o dokonalost :)<br>
Fizick je k pøístupnı na: <U>bag (at) hotmail (dot) ru</U>,
a jeho webová stránka s pozdìjšími verzemi musí bıt na: <a href="http://avisynth.org.ru"><cite>http://avisynth.org.ru</cite></a> nebo jeho zrcadle.
</p>

<p> Pro podporu jdìte na fórum <a href="http://forum.doom9.org/showthread.php?s=&threadid=56871"><cite>http://forum.doom9.org/showthread.php?s=&amp;threadid=56871</cite></a>.
</p>
<p><kbd>$English Date: 2005/10/05 18:12:43 $</kbd></p>
<p><kbd>Èeskı pøeklad:22.3.2009</kbd></p>
</body>
</html>
