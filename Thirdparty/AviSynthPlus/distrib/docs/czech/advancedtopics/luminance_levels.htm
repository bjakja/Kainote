<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
   <TITLE>Luminance levels</TITLE>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
</HEAD>
<BODY>
<h1>Úrovnì jasu</h1>
<p>Špatné úrovnì jsou bìnım pøehrávacím problémem. Je to pøedmìt, kterı je stále znovu
diskutován. Cílem tohoto tématu je soustøedit kolektivní znalosti Doom9 komunity
tıkající se tohoto pøedmìtu. Podìlte se prosím všichni o své vìdomosti.
Budu aktualizovat informace níe abych zaøadil vaše moudra.</p>
<h2>Obsah</h2>
<ul>
  <li><a href="#What_are_luminance_levels.3F"><span class="tocnumber">1</span>
    <span class="toctext">Co to jsou úrovnì jasu?</span></a></li>
  <li><a href="#How_can_I_see_if_the_levels_are_wrong.3F"><span class="tocnumber">2</span>
    <span class="toctext">Jak poznám jestli jsou úrovnì špatné?</span></a></li>
  <li><a href="#Which_combinations_give_wrong_levels.3F"><span class="tocnumber">3</span>
    <span class="toctext">Které kombinace dávají špatné úrovnì?</span></a></li>
  <li><a href="#How_can_I_correct_the_levels.3F"><span class="tocnumber">4</span>
    <span class="toctext">Jak mohu úrovnì opravit?</span></a>
    <ul>
      <li><a href="#Method_.231:_Adjusting_graphics_driver_settings"><span class="tocnumber">4.1</span>
<span class="toctext">Metoda #1: Úprava nastavení grafického ovladaèe</span></a></li>
      <li>
<a href="#Method_.232:_Convert_to_RGB32_with_ffdshow"><span class="tocnumber">4.2</span>
<span class="toctext">Metoda #2: Pøevod do RGB32 pomocí ffdshow</span></a></li>
      <li><a href="#Method_.233:_Levels_filter_in_ffdshow_video_decoder"><span class="tocnumber">4.3</span>
<span class="toctext">Metoda #3: Filtr Levels v ffdshow video dekodéru</span></a></li>
      <li><a href="#Method_.234:_Pixelshader_in_Media_Player_Classic"><span class="tocnumber">4.4</span>
<span class="toctext">Metoda #4: Pixelshader v Media Player Classic</span></a></li>
      <li><a href="#Method_.235:_Use_AviSynth_script_in_ffdshow_video_decoder"><span class="tocnumber">4.5</span>
<span class="toctext">Metoda #5: Pouití AviSynth skriptu v ffdshow video dekodéru</span></a></li>
      <li><a href="#Method_.236:_Monitor_settings"><span class="tocnumber">4.6</span>
<span class="toctext">Metoda #6: Nastavení monitoru</span></a></li>
      <li><a href="#Method_.237:_Resize_in_software"><span class="tocnumber">4.7</span>
<span class="toctext">Metoda #7: Zmìna velikosti v softwaru</span></a></li>
    </ul>
  </li>
  <li><a href="#Test_files"><span class="tocnumber">5</span>
<span class="toctext">Testové soubory</span></a></li>
</ul>

<a name="What_are_luminance_levels.3F"></a>
<h2><span class="mw-headline">Co to jsou úrovnì jasu?</span></h2>
<p>Digitální video je typicky enkódováno v YCbCr formátu. YCbCr je rodina
barevnıch prostøedí (YV12, YUY2, atd.), která enkóduje barevnou informaci (chroma)
oddìlenì od jasové informace (luma).</p>
<p>Existují dva standardy pro enkódování jasu (luminance). Pro
standarddefinition TV (SDTV) je standard BT.601, a pro high-definition TV
(HDTV) je standard BT.709.</p>
<p>Jasové hodnoty jsou v daném rozsahu. Naneštìstí není tento rozsah vdy stejnı.
Existují dva bìnì pouívané rozsahy: 0-255 (aka PC levels) a 16-235 (aka TV
levels). (Vysvìtlit proè ...) To platí jak pro YCbCr tak pro RGB formát.
Obvykle je vaše video uloeno v rozsahu 16-235 YCbCr, ale je pøehráváno zpìt v 0-255
RGB. To znamená, e úrovnì potøebují bıt v urèitém okamiku rozšíøeny (expandovány). Ale v
nìkterıch pøípadech bude vaše video uloeno jako 0-255 YCbCr (DV je takovı pøíklad), a
není potøeba ádné expandování.</p>
<p>Proto pøi pøevádìní YCbCr barevného prostøedí na RGB, musí bıt pouit správnı standard
(BT.601 nebo BT.709) a správnı rozsah (TV nebo PC levels).</p>
<p>Vıše uvedené nemusí bıt vdy provedeno správnì. Mùe to bıt špatnì kvùli urèitım
kombinacím video rendererù, rozlišení videa a nastavení grafického ovladaèe.</p>
<a name="How_can_I_see_if_the_levels_are_wrong.3F"></a>
<h2><span class="mw-headline">Jak poznám jestli jsou úrovnì špatné?</span></h2>
<p>Video vypadá vyprané a barvy nejsou ivé. Èerná je zobrazena jako tmavì šedá.
Bílá je zobrazena jako svìtle šedá.</p>
<p>Také je monı opak, ale je to ménì èasté. V takovém pøípadì jsou tmavé barvy
zobrazeny pøíliš tmavì, a svìtlé barvy jsou zobrazeny pøíliš jasnì.</p>
<a name="Which_combinations_give_wrong_levels.3F"></a>
<h2><span class="mw-headline">Které kombinace dávají špatné úrovnì?</span></h2>
<p>Roli hraje mnoho faktorù, take není moné dát seznam
kombinací, které vdy dají špatné úrovnì pro kadého. Níe je
(neúplnı) seznam situací ve kterıch se mohou špatné úrovnì vyskytnout (pøi sledování
PC monitoru). To znamená, e pøevádìjí YCbCr [16,235] na RGB
[16,235] (tedy úrovnì nejsou expandovány). Ale obecnì dejte prostì na své oèi.</p>
<ul>
  <li>Windows Vista + EVR CP + SD video + ATI</li>
  <li>Windows Vista + EVR CP + SD video + NVIDIA</li>
  <li>Windows XP + VMR-7 (renderless) + SD video + ATI</li>
  <li>Windows XP + VMR-9 (windowed) + SD video + ATI</li>
  <li>Windows XP + VMR-9 (renderless) + SD video + ATI</li>
  <li>Windows XP + EVR + SD video + ATI</li>
  <li>Windows XP + EVR CP + SD video + ATI</li>
</ul>
<p>(pokud máte doplnìní tohoto seznamu, tak ho prosím pošlete)</p>
<a name="How_can_I_correct_the_levels.3F"></a>
<h2><span class="mw-headline">Jak mohu úrovnì opravit?</span></h2>
<p>Metody níe pøedpokládají, e vysíláte video (uloené jako 16-235
YCbCr) na PC monitor nebo LCD TV, tedy zaøízení, které potøebuje RGB plného rozsahu
(0-255). Pokud pouíváte CRT TV, tak si pøeètìte komentáøe k metodám 2 a 3.</p>
<a name="Method_.231:_Adjusting_graphics_driver_settings"></a>
<h3><span class="mw-headline">Metoda #1: Úprava nastavení grafického ovladaèe</span></h3>
<p><b>NVIDIA</b></p>
<p>Od verze 177.84, ovladaèe NVIDIA mají monost konfigurace
rozsahu jasu (luma range).</p>
<p>Monost najdete zde: NVIDIA Control Panel -&gt; Video &amp;
Television -&gt; Adjust video color settings -&gt; Select &quot;With the NVIDIA
settings&quot; -&gt; Advanced tab -&gt; Set Dynamic Range to &quot;Full
(0-255)&quot;.</p>
<p><img border="0" src="../pictures/advancedtopics/nvidia_control_panel.jpg" width="633" height="466"></p>
<p><b>ATI</b></p>
<p>Ovladaè ATI vyaduje úpravu Registru. S pouitím úpravy ovladaè
pøevede TV úrovnì (levels) do PC úrovní pro video s SD (do 768x576) rozlišením. U to dìlá
jako vıchozí pro HD video.</p>
<p>Na dopracování: zahrnout idiotské potvrzení øešení pro aplikaci úpravy</p>
<p>Nìkteré úpravy ATI ovladaèe lze najít <a href="http://www.avsforum.com/avs-vb/showpost.php?p=11622510&amp;postcount=2011" class="external text" title="http://www.avsforum.com/avs-vb/showpost.php?p=11622510&amp;postcount=2011" rel="nofollow">zde</a>.
Nastavení UseBT601CSC je to, které se vztahuje k úrovním jasu.</p>
<a name="Method_.232:_Convert_to_RGB32_with_ffdshow"></a>
<h3><span class="mw-headline">Metoda #2: Pøevod do RGB32 pomocí ffdshow</span></h3>
<p>Donucení ffdshow vysílat RGB32 mùe pomoci zabránit problémùm s úrovní jasu.
Stinnou stránkou této metody je, e provádìní tohoto pøevodu v softwaru zvyšuje zatíení CPU.</p>
<p>Pro vynucení RGB32 vıstupu v ffdshow by jste mìli zrušit zatrení
všech barevnıch prostøedí kromì RGB32 na vıstupní stranì (Output page) v ffdshow konfiguraci.
Také se doporuèuje zapnout &quot;High quality YV12 to RGB conversion&quot;
(Vysoce kvalitní pøevod YV12 do RGB). Na stranì
pøevodu RGB, mùete zvolit kterı standard by mìl bıt pøedpokládán, BT.601 nebo BT709. Vyberte
první pro materiál s nízkım rozlišením, a druhı pro HD video.</p>
<p>Poznámka: monost automatického vıbìru zaloená na rozlišení videa
snad bude pøidána v blízké budoucnosti.</p>
<p>Tip: monost Profiles/Presets v ffdshow lze pouít pro vytvoøení rùznıch sad
nastavení. Dokonce mùete autonaèítat profily zaloené na podmínkách jako
rozlišení formátu videa. Mohli by jste napøíklad vytvoøit profil specificky
pro video s HD rozlišením, a pouít profil 'standard' pro videa s nízkım rozlišením.</p>
<p>Poznámka: Pøi vysílání do CRT TV, musíte vybrat &quot;Full Range&quot;
kontrast. Pro PC monitory a LCD TV, je vıchozí nastavení &quot;Standard&quot; kontrast
správné.</p>
<a name="Method_.233:_Levels_filter_in_ffdshow_video_decoder"></a>
<h3><span class="mw-headline">Metoda #3: Filtr Levels v ffdshow video dekodéru</span></h3>
<p>ffdshow má speciální filtr pro úpravu jasovıch (luminance) úrovní. Pro opravu
špatnıch úrovní jasu na PC monitorech nebo LCD TV obvykle potøebujete pøevést do
PC úrovní. Pro opravu špatnıch úrovní pro CRT TV, obvykle potøebujete pøevést do
TV úrovní.</p>
<p>Pro pøevod TV úrovní do PC úrovní pouijte 16-235 jako vstupní rozsah a 0-255 jako
vıstupní rozsah. Pro pøevod z PC úrovní do TV úrovní pouijte 0-255 jako vstupní rozsah
a 16-235 jako vıstupní rozsah.</p>
<a name="Method_.234:_Pixelshader_in_Media_Player_Classic"></a>
<h3><span class="mw-headline">Metoda #4: Pixelshader v Media Player Classic</span></h3>
<p>Pixelshader je malı program, kterı bìí na vašich grafickıch kartách a
zpracovává nìjaká grafická data. V tomto pøípadì kadı snímek vašeho videa.</p>
<p>Media Player Classic má speciální pixelshader zvanı &quot;16-235 -&gt;
0-255&quot; pro pøevádìní TV úrovní do PC úrovní. Tento shader jen upraví jasové
hodnoty. Existuje také shader zvanı &quot;BT.601 -&gt; BT.709&quot;. Ten je pokroèilejší
a také upravuje barevné (chroma) hodnoty.</p>
<p>Poznámka: souèasné shadery v MPC se vdy chovají stejnì, bez ohledu na
rozlišení videa. Protoe špatné úrovnì se nemusí objevit ve všech rozlišeních, nedoporuèuje se
mít zapnuté shadery poøád. Úprava úrovní kdy není potøeba
povede k neoptimálním vısledkùm.</p>
<p>Nìkteré poadavky pro pixelshadery v MPC:</p>
<ul>
  <li>Musíte pouít kompatibilní video renderer: VMR-7 (renderless), VMR-9
    (renderless), nebo EVR Custom Presenter.</li>
  <li>Nastavení plochy (surface) musí bıt nastaveno na &quot;3D surfaces&quot;.</li>
  <li>Vyaduje nìkteré DirectX komponenty, které nejsou zahrnuty ve vıchozí
    Windows instalaci. Spuste DirectX Web Installer aby jste získali poadované
    DirectX aktualizace.</li>
</ul>
<a name="Method_.235:_Use_AviSynth_script_in_ffdshow_video_decoder"></a>
<h3><span class="mw-headline">Metoda #5: Pouití AviSynth skriptu v ffdshow video dekodéru
</span></h3>
<p>Úprava úrovní nebo pøevod do RGB32 lze také provést pomocí AviSynth
skriptu v ffdshow. Je to pro pokroèilé uivatele.</p>
<p>Pokud je vaše video uloeno jako 16-235 YCbCr, otevøete kartu video dekodér v
ffdshow (zde je to provedeno pro MPC):</p>
<p><img border="0" src="../pictures/advancedtopics/ffdshow_avisynth.jpg" width="483" height="359"></p>
<p>Zatrhnìte okénko AviSynth, a vytvoøte následující skript</p>
<p><img border="0" src="../pictures/advancedtopics/ffdshow_avisynth2.jpg" width="578" height="296"></p>
<p>ffdshow se sám pøidá jako zdroj. Více informací najdete <a href="http://ffdshow-tryout.sourceforge.net/wiki/video:avisynth" class="external text" title="http://ffdshow-tryout.sourceforge.net/wiki/video:avisynth" rel="nofollow">zde</a>.</p>
<p>Pokud je vaše video uloeno jako 0-255 YCbCr, vytvoøte následující skript:</p>
<pre>ConvertToRGB(matrix=&quot;PC.601&quot;) # zachová video plného rozsahu (pouijte matrix=&quot;PC.709&quot; pokud je to vhodné)</pre>
<p>Pokud je vaše video uloeno jako 0-255 YCbCr a vy chcete poslat 16-235 YCbCr do
vašeho rendereru, pouijte</p>
<pre>ColorYUV(levels=&quot;PC-&gt;TV&quot;) # pøevod do TV-levels</pre>
<a name="Method_.236:_Monitor_settings"></a>
<h3><span class="mw-headline">Metoda #6: Nastavení monitoru</span></h3>
<p>Nìkteré monitory mohou bıt kalibrovány aby pøedpokládali urèitou úroveò jasu jako vstup.</p>
<a name="Method_.237:_Resize_in_software"></a>
<h3><span class="mw-headline">Metoda #7: Zmìna velikosti v softwaru</span></h3>
<p>Pokud se objeví špatné úrovnì jen u SD video rozlišení a ne u vysokıch
rozlišení, pak by bylo další øešení zmìnit velikost videa v softwaru. Napøíklad
ffdshow lze pouít pro zmìnu velikosti videa.</p>
<a name="Test_files"></a>
<h2><span class="mw-headline">Testové soubory</span></h2>
<p>Zde je nìkolik pìknıch testovıch klipù pro vyzkoušení vašeho nastavení: <a href="http://forum.doom9.org/showthread.php?p=1230259#post1230259" class="external text" title="http://forum.doom9.org/showthread.php?p=1230259#post1230259" rel="nofollow">Test
klipy</a> (díky littleD za jejich vytvoøení).</p>
<p><i>Díky <a href="http://forum.doom9.org/showthread.php?t=143689" class="external text" title="http://forum.doom9.org/showthread.php?t=143689" rel="nofollow">clsid</a>
za napsání tohoto vıborného èlánku.</i></p>
<p><kbd>$Enflish Date: 2009/08/22 17:35:09 $</kbd></p>
<p><kbd>Èeskı pøeklad:2.9.2009</kbd></p>
<FORM><INPUT TYPE="Button" VALUE="Zpìt"
onClick="history.go(-1)"></FORM>
</BODY>
</HTML>
