<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ru">
<head>
<title>Convolution3D</title>
  <meta content="text/html;charset=windows-1251" http-equiv="Content-Type">
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: convolution3d.htm,v 1.2 2006/12/13 21:01:40 fizick Exp $
-->
</head>
<body>
<h1>Convolution3D</h1>
<h2>Общая информация</h2>
<b>автор:</b> Vlad59
<br><b>версии: - </b>1.01 (YUY2 версия)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
- beta 4 (YV12 версия с блокированным параметром временнОго влияния <var>influence</var>)<br>
<b>закачка:</b> <a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a><br>
<b>категория:</b> Пространственно-временные сглаживатели
<br><b>требования:</b>&nbsp;
<ul>
  <li>YV12 или YUY2 (в зависимости от версии) цветовой формат</li>
  <li>поддержка ISSE</li>
</ul>
<hr>
<h2>Описание</h2>
Convolution3D это Avisynth фильтр, который применяет 3-мерную матричную свертку (3D convolution) ко всем
пикселам кадра.
<h2>1 - Как его использовать</h2>
<p><code>Convolution3d</code> (<var>matrix=0, ythresh=3, cthresh=4, t_ythresh=3, t_cthresh=4, influence=3,
debug=0</var>)</p>
<p><b>Выбор матрицы <var>matrix</var></b> : <br>
  0 : оригинальная матрица : <br>
  1 2 1&nbsp;&nbsp; 2 4 2&nbsp;&nbsp; 1 2 1<br>
  2 4 1&nbsp;&nbsp; 4 8 4&nbsp;&nbsp; 2 4 1<br>
  1 2 1&nbsp;&nbsp; 2 4 2&nbsp;&nbsp; 1 2 1<br>
  Эта матрица полезна для обычного видео (не мультфильмов анимэ), так как она сохраняет больше деталей.<br>
  1 : идея bb матрицы из всех единиц (прекрасная идея):<br>
  1 1 1&nbsp;&nbsp; 1 1 1&nbsp;&nbsp; 1 1 1<br>
  1 1 1&nbsp;&nbsp; 1 1 1&nbsp;&nbsp; 1 1 1<br>
  1 1 1&nbsp;&nbsp; 1 1 1&nbsp;&nbsp; 1 1 1<br>
  Эта матрица более полезна с анимэ или источниками плохого качества, так как она размывает
  немного сильнее (и значит удаляет больше шума).</p>
<p><b>ВременнОе влияние (Temporal influence)</b> :<br>
  Это использовано главным образом, чтобы немного ускорить этот фильтр, и чтобы избежать временной
  информации, когда в ней нет необходимости
  (смена сцены, затухание, ...)<br>
  Я сначала вычисляю Предел = (Временной порог яркости t_ythresh) * (Временное влияние influence)<br>
  Для каждых 2 обрабатываемых пикселов (из-за MMX, 2 пиксела одновременно), я сначала проверяю
  вот это :<br>
  Если <br>
  (Abs (Y0 - Y0[Предыдущий кадр]) +<br>
  Abs (Y0 - Y0[Следующий кадр]) +<br>
  Abs (Y1 - Y1[Предыдущий кадр]) +<br>
  Abs (Y1 - Y1[Следующий кадр])) &gt; Предел<br>
  тогда<br>
  делаем пространственную обработку (матрица только 3*3)<br>
  Иначе<br>
  Делаем пространственную и временнУю обработку (матрица 3*3*3)<br>
  Чем меньше эта величина -&gt; тем быстрее будет фильтр, но сжимаемость должна быть хуже.<br>
  Чем больше эта величина -&gt; тем медленнее будет фильтр, но сжимаемость должна быть выше.<br>
  Если временнОе влияние <var>influence</var> установлено в -1, то производится только пространственная обработка
  (высокая скорость).<br>
  Этот параметр - с плавающей точкой (float).</p>
<h2>2 - Примеры параметров</h2>
<p>Я сделал следующие наборы установок (preset) чтобы облегчить дело :<br>
<b>Convolution3d (preset=&quot;movieHQ&quot;)</b>// Фильм высокого качества (Movie Hi Quality) (хороший DVD)<br>
  это синоним для Convolution3D (0, 3, 4, 3, 4, 2.8, 0) <br>
<b>Convolution3d (preset=&quot;movieLQ&quot;)</b>// Фильм низкого качества
  (Movie Low Quality) (шумный DVD)<br>
  это синоним для Convolution3D (0, 6, 10, 6, 8, 2.8, 0) <br>
<b>Convolution3d (preset=&quot;animeHQ&quot;)</b> // Качественый мультфильм (Anime
  Hi Quality) (хороший DVD)<br>
  это синоним для Convolution3D (0, 6, 12, 6, 8, 2.8, 0) <br>
<b>Convolution3d (preset=&quot;animeLQ&quot;)</b>// Низкокачественный мультфильм (Anime
  Low Quality) (шумный DVD)<br>
  это синоним для Convolution3D (1, 8, 16, 8, 8, 2.8, 0) <br>
<b>Convolution3d (preset=&quot;animeBQ&quot;)</b> // Мультфильм плохого качества (Anime
  Bad Quality) (???)<br>
  это синоним для Convolution3D (1, 12, 22, 8, 8, 2.8, 0) <br>
<b>Convolution3d (preset=&quot;vhsBQ&quot;)</b>// захват VHS
  низкого качества (Bad Quality) (???)<br>
  это синоним для Convolution3D (0, 32, 128, 16, 64, 10, 0)</p>
<p>Я провел тест Convolution3d с ТВ захватом плохого качества и в этом случае
  вы должны повысить главным образом пороги цветности cthresh, t_cthresh (вызывающие некоторые призраки,
  но общее качество кажется будет лучше).<br>
  Я лично использую следующие параметры :</p>
<pre>Convolution3D (0, 32, 128, 32, 128, 10, 0)</pre>
<p>Такие пороги Convolution3d здесь только, чтобы заботиться о краях и смене сцены.
  Вы можете увеличить пространственные пороги ythresh, cthresh (главным образом порог цветности cthresh),
  но остановитесь, как только увидите некоторое размытие краев (если вы хотите качества).
  С предложенными установками Вы не должны иметь этой проблемы. <br>
  Временные пороги (t_ythresh, t_cthresh) должны оставаться ниже 10, чтобы избежать призраков.<br>
  Вы должны особенно проявить внимание к этим порогам с матрицей 1, так как
  с этой матрицей текущий кадр имеет меньший вес, так что легче формируются призраки.</p>
<p>Вы можете найти некоторую информацию о том, как он работает в : <a href="http://forum.doom9.org/showthread.php?s=&threadid=29829">http://forum.doom9.org/showthread.php?s=&amp;threadid=29829</a></p>
<h2>3 - Текущие ограничения или известные проблемы</h2>
<ul>
  <li>Работает только с YUV2, ПРОВЕРЕНО.</li>
  <li>требует процессор с поддержкой Integer SSE (не PII и K6-II), ПРОВЕРЕНО.</li>
</ul>
<p>ПРЕДУПРЕЖДЕНИЕ : он медленный, я знаю это и пытаюсь сделать его быстрее так что не подгоняйте меня
  с этим, заранее спасибо.</p>
<h2>4 - Благодарности</h2>
<p>Спасибо<br>
  bb за оригинальную идею и множество тестов<br>
  iago, Koepi и TheReal за реальные тесты на кино (или захватах) полной длительности<br>
  Tom Barry, Dividee и Sh0dan за их полезную техническую информацию или идеи<br>
  Ctrl-Alt-Suppr за французское руководство<br>
  Defiler за хостинг Convolution3d<br>
  всем пользователям Convolution3D</p>
<p>Vlad59 (babas.lucas@laposte.net)</p>
<h2>5 - Лицензия</h2>
<p><font size="-1">Copyright (c) 2002 S&eacute;bastien LUCAS. All rights reserved.<br>
  babas.lucas@laposte.net</p>
<p>Данный файл подлежит терминам Стандартной Публичной лицензии GNU, опубликованной Free Software Foundation.
Копия этой лицензии включена с дистрибутивом этой программы в файле COPYING.
Если Вы не получили копии, Вы можете получить копию написав в Free
Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.</p>
</font>
<p><font size="-1">Данная программа распространяется в надежде, что она будет полезна,
не БЕЗ ВСЯКОЙ ГАРАНТИИ; даже без подразумеваемой гарантии ТОВАРНОГО СОСТОЯНИЯ или ПРИГОДНОСТИ ДЛЯ КОНКРЕТНОЙ ЦЕЛИ.
Смотрите Стандартную лицензию GNU General Public License для дальнейших деталей.<br>
  </font> </p>
<p><font size="-1"><kbd>$Date: 2006/12/13 21:01:40 $<br>
Русский перевод 23.07.2005 Fizick http://bag.hotmail.ru</kbd></font></p>
</body>
</html>