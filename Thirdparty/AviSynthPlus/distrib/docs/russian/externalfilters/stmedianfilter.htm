<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ru"><head>
  <meta content="text/html;charset=Windows-1251" http-equiv="Content-Type">


<title>STMedianFilter</title><link rel="stylesheet" type="text/css" href="../../avisynth.css"><!--
Automatically generated, don't change:
$Id: stmedianfilter.htm,v 1.1 2005/06/11 20:46:10 fizick Exp $
--></head>
<body>
<h1>STMedianFilter</h1>
<h2>Общее описание</h2>
<span style="font-weight: bold;">автор</span><b>:</b>   Tom Barry
<br><b>версия:</b>     0.1.0.3<br>
<span style="font-weight: bold;">загрузка</span><b>:</b> <a href="http://mywebpages.comcast.net/trbarry/downloads.htm">http://mywebpages.comcast.net/trbarry/downloads.htm</a>
<br><b>категория:</b> Пространственно-временные сглаживатели<br><b>требования:</b>&nbsp;
<ul>
  <li>YV12 &amp; YUY2 цветовое пространство</li>
  <li>поддержка SSEMMX (=ISSE)&nbsp;</li>
</ul>

<hr align="center" size="2" width="100%">

<!-- #EndTemplate -->
<h2>Описание</h2>

<p>STMedianFilter это&nbsp;(слегка скомпенсированный
по движению) пространственно/временной медианный фильтр.</p>
<p>Он довольно&nbsp;тонкозернистый, используя только соседние пикселы в
пространстве и во времени, так что он смотрит на смежные 26 позиций,
чтобы
фильтровать каждую позицию. Он теперь (в последних версиях) фильтрует
как яркость, так и цветность, но фильтрация цветности несколько
ограничена,как описано ниже.&nbsp; </p>

<h3>Использование</h3>
<p><b>Чтобы использовать его, просто:</b></p>

<p>1) Поместите STMedianFilter.dll в какой-либо каталог. Вы можете взять его с адреса
<a href="http://www.trbarry.com/STMedianFilter.zip"> www.trbarry.com/STMedianFilter.zip</a></p>
<p>2) В Вашем скрипт-файле Avisynth, используйте команды наподобие&nbsp;</p>
<pre>LoadPlugin("F:\STMedianFilter\STMedianFilter.dll")
Avisource("D:\wherever\myfile.avi")
STMedianFilter(S_FilterThreshHold, S_EdgeThreshHold, T_FilterThreshHold, T_MotionThreshHold)&nbsp;
</pre>
<p>Конечно, замените имена файлов и каталогов на Ваши, и поставьте
целые величины для параметров. Допустимые величины каждого от 0 до 255.</p>
<p>(Префиксы) S и T (в названиях параметров) выше означают пространственный (spatial) и временной (temporal), соответственно.</p>
<p>Хорошая стартовая точка для величин параметров может быть</p>
<pre>STMedianFilter(8,15,4,7)</pre>
<p>Большие величины дают большую фильтрацию, но и больше артефактов.<br>
</p>
<h3>&nbsp;Описание параметров:</h3>

<p><var>S_FilterThreshHold</var> - не фильтровать пространственно
пиксел, если бы это изменило его более чем на этот порог. Большие
величины могут вызвать потерю тонких деталей, но это не слишком
чувствительно.&nbsp;</p>
<p><var>S_EdgeThreshHold</var> - не фильтровать пространственно пиксел,
если на крае, если величины изменяются более чем на этот порог. Он
&nbsp;кажется довольно терпимым, так что может быть значительно
увеличен при желании.&nbsp;</p>
<p><var>T_FilterThreshHold</var> - не фильтровать во времеми (темпорально) пиксел, если бы это изменило его более чем на этот порог. Большие величины могут вызвать призраки (шлейфы, ghosting). Не устанавливайте выше 5-10, чтобы избежать призраков.</p>
<p><var>T_MotionThreshHold</var> -&nbsp;не фильтровать во времени (темпорально) пиксел, если величины нескомпенсированного движения изменяются более чем на этот порог.&nbsp;Не устанавливайте выше&nbsp;10, чтобы избежать призраков.<br>
</p>
<p>(все параметры неименованные - прим. переводчика)</p>

<h2>Метод работы</h2>
<p>Если я понимаю это правильно, простой медианный фильтр это просто
шаг обрезки (clipping), где величина устанавливается, чтобы не выйти за
пределы прошлых высокой и низкой его соседей.&nbsp;
</p>
<p>Например, если вы имеете 3 пиксела в строке, которые
имеют величины &lt;5,8,7&gt;, то вы могли бы обрезать центральную
величину до не выходящей из пределов снизу 5 или сверху 7, то есть вы
установили бы ее равной 7.&nbsp;
</p>
<p>Теперь представьте что вы имели бы небольшой видео
экран 3x3, подобно поверхности кубика Рубика. Представьте предыдущий
кадр был бы нижним слоем кубика, текущий кадр был бы средним слоем, и
следующий кадр был бы верхним. &nbsp;
</p>
<p>Тогда текущий центральный пиксел был бы в центре
кубика Рубика и было бы&nbsp;13 путей (способов), как вы могли бы
провести линию через него и пару ближайших соседей.&nbsp;
</p>
<p>Что я&nbsp;делал, это сравнивал
каждую из этих пар соседей, чтобы увидеть, какая пара наиболее
согласуется по величине. Я&nbsp;использовал эту пару,
чтобы обрезать (clip) величину центрально пиксела.&nbsp;
</p>
<p>Я также обрезал (clipped) величину пиксела только, если как:
</p>
<p>1) это не изменило бы величину пиксела более чем на величину параметра FilterThreshold, так и&nbsp;&nbsp;
</p>
<p>2) количество 'нескомпенсированного движения' (согласие величины с соседями) было меньше чем велина параметра MotionThreshHold.<br>
</p>
<h2>История изменений</h2>
<ul>
  <li>2004/08/19&nbsp; v.0.1.0.3&nbsp;&nbsp;&nbsp; Выпущена Fizick 2005/01/30<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Исправлена ошибка с радиусом пространственного фильтра для YV12<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Спасибо&nbsp;Fizick за это.&nbsp; Теперь также опять на www.trbarry.com</li>
  <li>2004/08/10&nbsp; V 0.1.0.2 &nbsp;&nbsp;&nbsp; от Fizick&nbsp; - не публичная<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Исправлена одна главная ошибка (для YUY2 и YV12 режимов):<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; во всех предыдущих версиях светлые пикселы не фильтровались,<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; и также не работали как  S_EdgeThreshHold, так и T_MotionThreshHold.</li>
  <li>2003/06/22&nbsp; V 0.1.0.1&nbsp;&nbsp;&nbsp; Исправлена ошибка влияющая только на YV12</li>
  <li>2003/01/22&nbsp; V 0.1.0.0&nbsp;&nbsp;&nbsp; Снова удалена фильтрация цветности. Добавлена поддержка YV12. Использован Pluginit2<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Также удалены Горизонтальные параметры, добавил их к пространственным.<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Надеюсь исправлено розовое окрашивание.</li>
  <li> 2002/08/03&nbsp; V 0.0.3.0&nbsp;&nbsp; Добавлена некоторая фильтрация цветности (по вертикали - прим. переводчика)</li>
  <li>2002/08/03&nbsp; V 0.0.2.0&nbsp;&nbsp; Ошибки, Расщеплены пространственные, временные, горизональные параметры</li>
  <li>2002/08/02&nbsp; V 0.0.1.0&nbsp;&nbsp; Начальный тестовый&nbsp;выпуск <br>
  </li>
</ul>

<p><kbd>$English Date: 2004/08/17 20:31:19 $<br>
Русский перевод и добавления 11.06.05 Fizick http://bag.hotmail.ru</kbd>
</p>
</body></html>