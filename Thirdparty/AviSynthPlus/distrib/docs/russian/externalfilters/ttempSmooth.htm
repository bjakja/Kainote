<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en"><html>
<html lang="ru">
<head>
<title>TTempSmooth</title>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: ttempSmooth.htm,v 1.1 2006/05/13 13:49:13 fizick Exp $
-->
</head>
<body>
<h1>TTempSmooth</h1>
<h2>Общая информация</h2>
<b>Автор:</b>    tritical
<br><b>Версия:</b>        0.9.4<br>
<b>Загрузка:</b>   <a href="http://bengal.missouri.edu/~kes25c/">http://bengal.missouri.edu/~kes25c/</a>
<br><b>Категория:</b>  временн<b>ы</b>е сглаживатели  (Temporal Smoothers)<br>
<b>Требования:</b>&nbsp;
<ul>
  <li>Цветовое пространство YV12 или YUY2</li>
</ul>

<p><b>Лицензирование:</b> GPL</p>

<hr size=2 width="100%" align=center>

<!-- #EndTemplate -->
<h2>Обзор</h2>
<p><code>TTempSmooth</code> это адаптивный к движению (он работает только на
статичных частях изображения) фильтр временн<b>о</b>го сглаживания.
В настоящее время поддерживаются цветовые форматы YV12 и YUY2.
<code>TTempSmoothF</code> - более быстрая (40-50%)
версия <code>TTempSmooth</code>, у которой отсутствуют параметры
<var>lmdiff</var>/<var>cmdiff</var> (это эквивалентно запуску
<code>TTempSmooth</code> с параметрами <var>lmdiff</var>/<var>cmdiff</var>
равными или больше чем <var>lthresh</var>-1/<var>cthresh</var>-1).</p>
<h3>Синтаксис:</h3>
<p><code>TTempSmooth</code> (clip, int <var>&quot;maxr&quot;</var>,
int <var>&quot;lthresh&quot;</var>, int <var>&quot;cthresh&quot;</var>,
int <var>&quot;lmdiff&quot;</var>, int <var>&quot;cmdiff&quot;</var>,
int <var>&quot;strength&quot;</var>, float <var>&quot;scthresh&quot;</var>,
bool <var>&quot;fp&quot;</var>, int <var>&quot;vis_blur&quot;</var>,
bool <var>&quot;debug&quot;</var>, bool <var>&quot;interlaced&quot;</var>,
PClip <var>&quot;pfclip&quot;</var>)<br>
<br>
<code>TTempSmoothF</code> (clip, int <var>&quot;maxr&quot;</var>,
int <var>&quot;lthresh&quot;</var>, int <var>&quot;cthresh&quot;</var>,
float <var>&quot;scthresh&quot;</var>,
bool <var>&quot;fp&quot;</var>, int <var>&quot;vis_blur&quot;</var>,
bool <var>&quot;debug&quot;</var>, bool <var>&quot;interlaced&quot;</var>,
PClip <var>&quot;pfclip&quot;</var>)</p>
<h3>ПАРАМЕТРЫ</h3>
<br><p><var>maxr</var> -  (максимальный временн<b>о</b>й радиус)</p>
<p>Устанавливает максимальный временн<b>о</b>й радиус.
Между прочим  <code>TTempSmooth</code> автоматически меняет
радиус... Здесь задается максимальная граница.  Возможны величины от 1 до 7.
При 1 <code>TTempSmooth</code>
может (максимально) использовать пиксели на удалении 1 кадра от среднего кадра
(всего 3 кадра может быть рассмотрено включая текущий кадр).
При 7 будет задействованы пиксели на удалении до 7 соседних кадров
(всего 15 кадров будет рассмотрено). С проверкой на движение не очень
опасно устанавливать большие значения, в основном выбор качество либо скорость.
Низкие значения быстрее, в то время как большие
величины стремятся создать более стабильную картинку.</p>
<p>по умолчанию = 3 (int)</p>
<br><p><var>lthresh</var>/<var>cthresh</var> - (Порог движения яркости и цветности)</p>
<p>Ваши стандартные пороги для яркости и цветности, т.е. на сколько различаются
 пиксели между кадрами.
<var>lthresh</var> для яркости и <var>cthresh</var> для цветности.
<code>TTempSmooth</code> проверяет 2 межкадровых промежутка от текущего кадра
(назад и вперед - прим. ред.), так что можно устанавливать немного
большие значения, чем для большинства временн<b>ы</b>х сглаживателей и всё же
избегать артефактов. Правильные значения - от 1 до 256. Так же важно то, что пока
"<var>mdiff</var>" меньше чем величина порога,
то пиксели с большими отличиями от оригинала
будут иметь меньший вес в среднем значении.
Таким образом, даже с довольно большим порогом пиксели чуть ниже
порога не будут иметь большой вес, что помогает уменьшить артефакты.</p>
<p>по умолчанию - <var>lthresh</var> = 4  (int)<br>
<var>cthresh</var> = 5  (int)</p>
<br><p><var>lmdiff</var>/<var>cmdiff</var> - (поддерживать различие) -
(используется только в <code>TTempSmooth</code>, нет в <code>TTempSmoothF</code>)</p>
<p>Любые пиксели с различиями менее или равное чем "<var>mdiff</var>" будут
смазаны по максимуму.  Обычно, чем больше различие со средним пикселем,
тем меньше "вес" в усреднении.  <var>mdiff</var> заставляет <code>TTempSmooth</code>
обрабатывать пиксели, имеющие разницу меньшие или равные "<var>mdiff</var>",
как будто у них разница равна  0.  Другими словами, это отодвигает точку
нулевого различия подальше. Установите величину "<var>mdiff</var>"
больше и равно чем <var>lthresh</var>-1/<var>cthresh</var>-1,
чтобы полностью отключить взвешивание по обратной (1/x - прим. пер.)
разнице пикселей.
Правильные значения от 0 до 255. <var>lmdiff</var> - для яркости,
а <var>cmdiff</var> - для цветности.</p>
<p>по умолчанию - <var>lmdiff</var> = 2  (int)<br>
<var>сmdiff</var> = 3 (int)</p>
<br><p><var>strength</var> - (показатель пространственного веса)</p>
<p><code>TTempSmooth</code> использует обратную (1/x - прим. пер.) к расстоянию,
чтобы решить, какой вес давать каждой величине пикселя.
Параметр <var>strength</var> позволяет вам сместить точку спада дальше от центра,
что дает более сильный эффект сглаживания и добавить вес к внешним пикселям.
 Это делает для пространственного веса то же,
что <var>mdiff</var> делает для веса разницы. Возможные варианты:<br>
<br>

          1 =    0.13 0.14 0.16 0.20 0.25 0.33 0.50 1.00 0.50 0.33 0.25 0.20 0.16 0.14 0.13<br>
          2 =    0.14 0.16 0.20 0.25 0.33 0.50 1.00 1.00 1.00 0.50 0.33 0.25 0.20 0.16 0.14<br>
          3 =    0.16 0.20 0.25 0.33 0.50 1.00 1.00 1.00 1.00 1.00 0.50 0.33 0.25 0.20 0.16<br>
          4 =    0.20 0.25 0.33 0.50 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.50 0.33 0.25 0.20<br>
          5 =    0.25 0.33 0.50 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.50 0.33 0.25<br>
          6 =    0.33 0.50 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.50 0.33<br>
          7 =    0.50 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.50<br>
          8 =    1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00<br>
<br>
Показаны величины для <var>maxr</var> = 7, при использовании меньшего радиуса,
 вес вне диапазона просто не будет использоваться. Таким образом, установление
 величины <var>strength</var> равное <var>maxr</var>+1 или больше делает
пространственный вес одинаковый для всех пикселей. В версиях до v0.9.3
всегда использовались весовые значения как для <var>strength</var> = 2.
</p>
<p>по умолчанию = 2 (int)</p>
<br><p><var>scthresh</var> - (Порог смены сцены)</p>
<p>Стандартный порог изменения сцены - это процент максимально возможного
изменения плоскости luma. Хороший диапазон значений между 8 и 15.
Используйте опцию <var>debug</var> для выбора, какие кадры были обнаружены
 как изменение сцены и насколько величина изменяется для каждого кадра.
 Установите <var>scthresh</var><=0.0 для отключения обнаружения изменения сцен.
</p>
<p>по умолчанию = 12.0 (float)</p>
<br><p><var>fp</var> - (усреднение регулярное или фиксированное по количеству)</p>
<p>Установка <var>fp</var>=true будет добавлять вес, не доданный внешним
пикселям (из возможного), назад, к центральному пикселю,
когда вычисляется финальная величина.  Установка <var>fp</var>=false будет
просто делать нормальное взвешенное усреднение. <var>fp</var>=true
значительно лучше для уменьшения артефактов в подвижных областях и производстве хороших
результатов в общем.
</p>
<p>по умолчанию = true (bool)</p>
<br><p><var>vis_blur</var> - (визуализация размытия)</p>
<p>Эта опция выводит карту, которая показывает какие пиксели будут
отфильтрованы и на сколько. Для каждого пикселя она вычисляет, как
много веса было дано внешним пикселям (т.е. не центральному пикселю)
из максимально возможного веса, который мог бы быть дан внешним пикселям.
  Затем результат масштабируется в диапазон от 0 до 255,
  так что в областях, где не было дано веса внешним пикселям,
(не производиться ни какого сглаживания) карта будет показана черным,
а в областях, где весь возможный вес был дан внешним пикселям
(максимальное сглаживание имеет место) карта будет белая.  Другими словами,
чем темнее величина, тем слабее сглаживание, чем ярче величина,
тем больше сглаживание.
<br>Возможные величины:
<br>0 - не показывать карту
<br>1 - карта размытия Y плоскости
<br>2 - карта размытия U плоскости
<br>3 - карта размытия V плоскости
</p>
<p>по умолчанию = 0 (int)</p>
<br><p><var>debug</var> - (вывод отладочной информации)</p>
<p>Если включено, <code>TTempSmooth</code> выводит статистику срабатываний
изменения сцен и показывает какие кадры
обнаружены как изменение сцены. Это предназначено, чтобы помочь настроить
<var>scthresh</var>. Вы можете использовать
<a href=http://www.sysinternals.com/Utilities/DebugView.html>
<cite>"DebugView" от sysinternals.</cite></a>
<p>по умолчанию = false (bool)</p>
<br><p><var>interlaced</var> - (интерлейсный YV12 ввод)</p>
<p>Установите это в true, если Вы используете <code>TTempSmooth</code>
для чересстрочного YV12 клипа. В противном случае установите false.
Эта настройка имеет эффект только для YV12 и не имеет эффекта на YUY2,
потому что чересстрочный YUY2 не нуждается в специальной обработке.
<p>по умолчанию = false (bool)</p>
<br><p><var>pfclip</var> - (предварительно фильтрованный клип
для разницы между пикселями)</p>
<p>Это позволяет Вам задавать отдельный клип для <code>TTempSmooth</code>,
чтобы использовать его при расчете разницы между пикселями.
Это относится к проверке порогов движения, вычисляющий вес как обратную
к разнице между пикселями, и обнаружению изменения сцен. В общем, pfclip
будет использоваться, чтобы определять вес усредненной величины,
но вес будет применен к оригинальным значениям пикселей.
Эта опция подобна "<var>ppClip</var>" в <code>TBilateral</code>...
Несколько предложений возможных для префильтрации:
размытия Гаусса, адаптивные медианы, и т.д...
<p>по умолчанию = NULL (PClip)</p>
<h2>История изменений</h2>
<p>   11/17/2005  v0.9.4<br>
       + Добавлен параметр <var>interlaced</var> (исправляющий некорректную
       обработку цветности для чересстрочного YV12)<br>
       + Добавлен параметр <var>pfclip</var><br>
       + Добавлена MMX программа смены сцены (для тех у кого процессор не поддерживает iSSE)<br>
       - Изменено значение по умолчанию <var>scthresh</var> на 12.0</p>
<p>   07/20/2005  v0.9.3<br>
       + Добавлено обнаружение изменения сцены<br>
       + Добавлена опция визуализации размытия<br>
       + Снова добавлен <var>fp</var> и способ регулярного усреднения (был удален в v0.9.1)<br>
       + Добавлен <var>debug</var><br>
       + Добавлена опция <var>strength</var> для регулировки пространственного веса<br>
       + Переписан весь код (значительно сократился общий размер исходного кода)<br>
       + 10% увеличения скорости для <code>TTempSmooth()</code><br>
       - Заменён <var>maxr</var> вместо <var>maxd</var>,
       увеличен максимально возможный радиус с 4 до 7
и уменьшен минимально возможный радиус с 2 на 1<br>
       - Переименованы некоторые параметры (<var>mdiff</var>=<var>lmdiff</var>,
        <var>mdiffc</var>=<var>cmdiff</var>)<br>
       - Изменены значения по умолчанию <var>lmdiff</var>/<var>cmdiff</var>
        на 2/3 (было 3/4)</p>
<p>   07/29/2004  v0.9.2<br>
       - Модифицирован код буферизации, удалены ненужные <code>BitBlts()</code>
       ... небольшое увеличение скорости (5-10%).<br>
       - Кадры запрошенные в линейном порядке полностью заполняют буфер.<br>
       - Добавлен <code>TTempSmoothF()</code>, более быстрая версия
       <code>TTempSmooth</code> (50-75%), которая эквивалентна использованию
<code>TTempSmooth()</code> с <var>mdiff</var>/<var>mdiffC</var> равными или
больше чем <var>LThresh</var>/<var>CThresh</var>.  Таким образом нужны только параметры
<var>maxd</var>, <var>LThresh</var>, и <var>CThresh</var>.<br>
       - Изменены значения по умолчанию, чтобы не быть слишком агрессивными.<br>
       - Нет никакого изменения качества, те же настройки производят
       ту же фильтрацию как в v0.9.1.</p>
<p>06/15/2004  v0.9.1<br>
       - Исправлена большая ошибка, которая приводила к неправильному расчету
       разницы для chroma, что делало фильтр полностью бесполезным.<br>
       - Избавился от параметров <var>amount</var>/<var>amountC</var>
       и <var>fixedPoint</var>. Они были не нужны, т.к. когда <var>amount</var> и
<var>fixedPoint</var> = true всегда работало лучше чем false...<br>
       - Небольшое увеличение скорости<br>
       - Изменены некоторые настройки по умолчанию.</p>
<p>06/11/2004  v0.9<br>
       - Первая версия</p>
<p><kbd>$English Date: 2005/07/12 16:11:01 $<br>
Русский перевод 09.05.2006 AI<br>
Редакция 12.05.2006 Fizick http://avisynth.org.ru</kbd>
</p>
</body>
</html>
