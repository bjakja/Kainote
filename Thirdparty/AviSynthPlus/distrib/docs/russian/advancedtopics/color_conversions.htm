<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML lang="ru">
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
   <META NAME="GENERATOR" CONTENT="Microsoft FrontPage 4.0">
   <TITLE>Цветовые преобразования</TITLE>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!-- Automatically generated, don't change:
$Id: color_conversions.htm,v 1.2 2006/04/11 16:03:54 fizick Exp $
-->
</HEAD>
<BODY>
<p>работа в стадии составления.</p>
<p>Должна охватить преобразования RGB->YUV и масштабирование/сохранение диапазона яркости
и когда использовать какое преобразование.</p>
<h2>Цветовые преобразования</h2>
<table border="1" width="75%">
  <tr>
    <td width="33%"> коэффициенты</td>
    <td width="33%" align="center"> Rec.601</td>
    <td width="34%" align="center"> Rec.709&nbsp;</td>
    <td width="34%" align="center"> FCC</td>
  </tr>
  <tr>
    <td width="33%"> Kr : коэффициент красного (R) канала</td>
    <td width="33%" align="center"> 0.299</td>
    <td width="34%" align="center"> 0.2125</td>
    <td width="34%" align="center"> 0.3</td>
  </tr>
  <tr>
    <td width="33%"> Kg : коэффициент зеленого (G) канала</td>
    <td width="33%" align="center"> 0.587</td>
    <td width="34%" align="center"> 0.7154</td>
    <td width="34%" align="center"> 0.59</td>
  </tr>
  <tr>
    <td width="33%"> Kb : коэффициент синего (B) канала</td>
    <td width="33%" align="center"> 0.114</td>
    <td width="34%" align="center"> 0.0721</td>
    <td width="34%" align="center"> 0.11</td>
  </tr>
</table>
<p>(0.0 &lt;= [Y,R,G,B] &lt;= 1.0) ; (-1.0 &lt; [U,V] &lt; 1.0)</p>
<p>Kg = 1 - Kr - Kb</p>
<p>Y = Kr*R + Kg*G + Kb*B<br>
V = (R - Y)/(1-Kr) = R - G * Kg/(1-Kr) - B * Kb/(1-Kr)<br>
U = (B - Y)/(1-Kb) = - R * Kr/(1-Kb) - G * Kg/(1-Kb) + B</p>
<p>R = Y + V*(1-Kr)<br>
G = Y - U*(1-Kb)*Kb/Kg - V*(1-Kr)*Kr/Kg<br>
B = Y + U*(1-Kb)</p>
<h3>Преобразование к величинам для программирования</h3>
<p><b>YUV [0,255] &lt;-> RGB [0,255]</b> (0 &lt;= [r,g,b] &lt;= 255, 0 &lt;= y &lt;= 255, 0 &lt; [u,v] &lt; 255)</p>
<p>y = Y * 255<br>
v = V * 127.5 + 128<br>
u = U * 127.5 + 128<br>
r = R * 255<br>
g = G * 255<br>
b = B * 255</p>
<p>Подстановка (Y,V,U,R,G,B) в вышеуказанные уравнения и умножение на 127.5 и соответственно 255 дает</p>
<p>y = Kr*r + Kg*g + Kb*b<br>
v - 128 = 0.5*(r - y)/(1-Kr) = 0.5 * r - 0.5 * g * Kg/(1-Kr) - 0.5 * b * Kb/(1-Kr)<br>
u - 128 = 0.5*(b - y)/(1-Kb) = - 0.5 * r * Kr/(1-Kb) - 0.5 * g * Kg/(1-Kb) + 0.5 * b</p>
<p>r = y + 2*(v-128)*(1-Kr)<br>
g = y - 2*(u-128)*(1-Kb)*Kb/Kg - 2*(v-128)*(1-Kr)*Kr/Kg<br>
b = y + 2*(u-128)*(1-Kb)</p>
<p><b>YUV [16,235] &lt;-> RGB [0,255]</b> (0 &lt;= [r,g,b] &lt;= 255, 16 &lt;= y &lt;= 235, 16 &lt;= [u,v] &lt;= 240)</p>
<p>y = Y * 219 +  16<br>
u = U * 112 + 128<br>
v = V * 112 + 128<br>
r = R * 255<br>
g = G * 255<br>
b = B * 255</p>
<h2>Ссылки</h2>
<p>http://www.poynton.com/notes/colour_and_gamma/ColorFAQ.html<br>
ITU BT.601 ...<br>
ITU BT.709 ...</p>
<p><kbd>$English Date: 2006/03/26 18:06:55 $<br>
Русский перевод 28.06.2005-11.04.2006 Fizick http://bag.hotmail.ru</kbd></p>
<FORM><INPUT TYPE="Button" VALUE="Back"
onClick="history.go(-1)"></FORM>
</BODY>
</HTML>
